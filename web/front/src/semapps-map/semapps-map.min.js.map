{"version":3,"sources":["web/front/src/semapps-map/semapps-map.js"],"names":["onMapClick","e","log","semapps","map","OSM","scrollWheelZoom","enabled","disable","enable","mouseOver","element","document","getElementById","$","animate","height","hide","style","display","show","mouseOut","getDetail","elem","goToPath","uri","window","encodeURIComponent","rel","Polymer","is","properties","route","type","Object","observer","pins","Array","value","attached","this","ready","SemAppsCarto","start","bind","L","setView","tileLayer","attribution","addTo","markers","markerClusterGroup","addLayer","off","on","pinAvailaible","awesome","http://virtual-assembly.org/pair#Person","AwesomeMarkers","icon","markerColor","http://virtual-assembly.org/pair#Organization","http://virtual-assembly.org/pair#Project","http://virtual-assembly.org/pair#Event","http://virtual-assembly.org/pair#Proposal","http://virtual-assembly.org/pair#Document","http://virtual-assembly.org/pair#DocumentType","pinShowAll","key","hasOwnProperty","pinShow","addPin","latitude","longitude","text","undefined","marker","bindPopup","pinShowOne","pinHideAll","pinHide","removeLayer","handleClick","preventDefault","scrollToContent","myRoute"],"mappings":"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","file":"semapps-map.min.js","sourcesContent":["Polymer({\n  is: 'semapps-map',\n\n  properties: {\n    route: {\n      type: Object,\n      observer: '_routeChanged'\n    },\n    pins: {\n      type: Array,\n      value: []\n    },\n  },\n\n  // Wait all HTML to be loaded.\n  attached() {\n    this.ready = false;\n    // Global ref.\n    semapps.map = this;\n\n    // Wait for buildings to be loaded.\n    SemAppsCarto.ready(this.start.bind(this));\n  },\n\n  start() {\n    \"use strict\";\n      this.OSM = L.map('semapps').setView([48.862725, 2.287592000000018], 6);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n      }).addTo(this.OSM );\n      this.markers = L.markerClusterGroup();\n      this.OSM.addLayer(this.markers) ;\n      this.OSM.scrollWheelZoom.disable();\n      this.OSM.off('dblclick');\n      this.OSM.on('dblclick', onMapClick);\n      this.OSM.on('mouseover',mouseOver);\n      this.OSM.on('mouseout',mouseOut);\n      this.pinAvailaible = [];\n      this.awesome= {\n          \"http://virtual-assembly.org/pair#Person\":L.AwesomeMarkers.icon({\n              icon: 'user',\n              markerColor: 'blue'\n          }),\n          \"http://virtual-assembly.org/pair#Organization\":L.AwesomeMarkers.icon({\n              icon: 'tower',\n              markerColor: 'blue'\n          }),\n          \"http://virtual-assembly.org/pair#Project\":L.AwesomeMarkers.icon({\n              icon: 'screenshot',\n              markerColor: 'red'\n          }),\n          \"http://virtual-assembly.org/pair#Event\":L.AwesomeMarkers.icon({\n              icon: 'calendar',\n              markerColor: 'orange'\n          }),\n          \"http://virtual-assembly.org/pair#Proposal\":L.AwesomeMarkers.icon({\n              icon: 'info-sign',\n              markerColor: 'green'\n          }),\n          \"http://virtual-assembly.org/pair#Document\":L.AwesomeMarkers.icon({\n              icon: 'folder-open',\n              markerColor: 'black'\n          }),\n          \"http://virtual-assembly.org/pair#DocumentType\":L.AwesomeMarkers.icon({\n              icon: 'pushpin',\n              markerColor: 'black'\n          }),\n      }\n\n  },\n\n    /**\n     * affiche tous les points enregistré\n     */\n    pinShowAll() {\n        \"use strict\";\n        for (let key in this.pins) {\n            if (this.pins.hasOwnProperty(key)) {\n                this.pinShow(key);\n            }\n        }\n    },\n\n    pinShow(key){\n        \"use strict\";\n        if (this.pins.hasOwnProperty(key) && this.pinAvailaible[key]) {\n            this.markers.addLayer(this.pins[key]);\n            this.pinAvailaible[key] = false;\n\n        }else{\n            log(\"error: \" + key + \" is not a marker\")\n            log(this.pins)\n        }\n\n        //this.pins[key].addTo(this.OSM);\n    },\n\n\n    addPin(latitude,longitude, key, text,type) {\n        \"use strict\";\n        this.pinAvailaible[key] = true;\n        if (this.awesome[type] !== undefined) {\n            this.pins[key] = L.marker([latitude,longitude],  {icon: this.awesome[type]})\n                .bindPopup( '<a href=\"#\" onclick=\"getDetail(this)\" rel=\"'+key+'\"><h5>'+text+'</h5> </a>');\n        }else{\n            this.pins[key] = L.marker([latitude,longitude])\n                .bindPopup('<a href=\"#\" onclick=\"getDetail(this)\" rel=\"'+key+'\"><h5>'+text+' </h5></a>');\n        }\n\n        this.pinShow(key);\n    },\n    /**\n     * affiche un point et efface les autres\n     * @param key -- la clé qui va être la seule affiché\n     */\n    pinShowOne(key) {\n        \"use strict\";\n        this.pinHideAll();\n        this.pinShow(key);\n    },\n\n    /**\n     * efface un point\n     * @param key -- la clé du point a ne plus afficher\n     */\n    pinHide(key) {\n        \"use strict\";\n        if(this.pins[key] !== undefined && !this.pinAvailaible[key]){\n            let marker = this.pins[key];\n            this.markers.removeLayer(marker);\n            this.pinAvailaible[key] = true;\n        }\n\n    },\n\n    /**\n     * efface tous les points\n     */\n    pinHideAll() {\n        \"use strict\";\n        log('start pinHideAll');\n        log(this.pins);\n        for (let key in this.pins){\n            if (this.pins.hasOwnProperty(key)) {\n                this.pinHide(key);\n            }\n        }\n        log('stop pinHideAll');\n\n    },\n\n    handleClick(e) {\n        e.preventDefault();\n        semapps.scrollToContent();\n        semapps.myRoute = \"detail\";\n        semapps.goToPath('detail', {\n            uri: window.encodeURIComponent(this.uri)\n        });\n    },\n\n\n});\n\nfunction onMapClick(e) {\n    log('onMapClick');\n\n    if (semapps.map.OSM.scrollWheelZoom.enabled()) {\n        semapps.map.OSM.scrollWheelZoom.disable();\n    }\n    else {\n        semapps.map.OSM.scrollWheelZoom.enable();\n    }\n    mouseOver();\n}\nfunction mouseOver(e) {\n    log('mouseOver');\n    let element = document.getElementById('semapps-map-black');\n    if(!semapps.map.OSM.scrollWheelZoom.enabled()){\n        $('#semapps-map-black').animate({ height: \"100%\"},'fast','linear');\n        element.style.display = 'block';\n        $('#semapps-map-message').show()\n    }\n    else{\n        $('#semapps-map-black').animate({ height: \"0px\"},'fast','linear');\n        $('#semapps-map-message').hide()\n    }\n}\nfunction mouseOut(e){\n    log('mouseOut');\n\n    $('#semapps-map-message').hide();\n    $('#semapps-map-black').animate({ height: \"0px\"},'fast','linear')\n}\nfunction getDetail(elem) {\n    semapps.goToPath('detail', {\n        uri: window.encodeURIComponent(elem.rel)\n    });\n}\n"]}