{"version":3,"sources":["web/front/src/semapps-detail/semapps-detail.js"],"names":["Polymer","is","properties","id","String","title","description","queryParams","observer","_queryChanged","data","_this","this","uri","SemAppsCarto","ready","detailLoad","handleBack","e","preventDefault","semapps","goSearch","handleEdit","path","entities","child","type","nameType","window","location","replace","attached","_this2","initElementGlobals","encodedUri","_this3","pathname","indexOf","myRoute","loading","$","detail","style","display","ajax","detailLoadComplete","map","pinHideAll","responseJSON","image","imageOrFallback","address","addressLabel","pins","pinShowOne","getAddressToCreatePoint","inner","document","createElement","toLowerCase","parent","domInner","getElementById","innerHTML","appendChild"],"mappings":"YAAAA,UACEC,GAAI,iBACJC,YACEC,GAAIC,OACJC,MAAOD,OACPE,YAAaF,OACbG,aACEC,SAAU,kBAIdC,cAXM,SAWSC,GAAM,GAAAC,GAAAC,IAEfF,IAAQA,EAAKG,KAEfC,aAAaC,MAAM,WACjBJ,EAAKK,WAAWN,EAAKG,QAK3BI,WArBM,SAqBMC,GAEVA,EAAEC,iBACFC,QAAQC,YAGVC,WA3BM,SA2BKJ,GAETA,EAAEC,gBACF,IAAII,GAAO,GACX,QAAQH,QAAQI,SAASZ,KAAKa,MAAMC,MAAMC,UACxC,IAAK,eACHJ,GAAQ,gCAAkCX,KAAKT,GAGnDyB,OAAOC,SAASC,QAAQP,IAG1BQ,SAvCM,WAuCM,GAAAC,GAAApB,IAEVE,cAAaC,MAAM,WACjBK,QAAQa,mBAARD,MAIJhB,WA9CM,SA8CMkB,GAAY,GAAAC,GAAAvB,MAE8B,IAAhDgB,OAAOC,SAASO,SAASC,QAAQ,YACjCjB,QAAQkB,QAAU,UAEE,WAApBlB,QAAQkB,UAEV1B,KAAK2B,SAAU,EAEf3B,KAAK4B,EAAEC,OAAOC,MAAMC,QAAU,OAE9BvB,QAAQwB,KAAK,yBAA2BV,EAAY,SAACxB,GAGjDyB,EAAKU,mBAAmBnC,OAKhCmC,mBAjEM,SAiEcnC,GAOlB,GAJAU,QAAQ0B,IAAIC,aACZrC,EAAOA,EAAKsC,aAAaP,WACzB7B,KAAK4B,EAAEC,OAAOC,MAAMC,QAAU,GAC9BjC,EAAKR,WAAW+C,MAAQ7B,QAAQ8B,gBAAgBxC,EAAKR,WAAW+C,MAAOvC,EAAKR,WAAWwB,MACpFhB,EAAKR,WAAWiD,QAAS,CAC1B,GAAIC,GAAe1C,EAAKR,WAAWiD,QAAQ,EACxC/B,SAAQ0B,IAAIO,KAAK3C,EAAKG,KACvBO,QAAQ0B,IAAIQ,WAAW5C,EAAKG,KAG5BO,QAAQmC,wBAAwBH,EAAa1C,EAAKL,MAAMK,EAAKR,WAAWwB,KAAK,GAAGhB,EAAKG,KAIzF,GAAI2C,GAAQC,SAASC,cAAc,kBAAoBtC,QAAQI,SAASd,EAAKR,WAAWwB,MAAMC,SAASgC,cACvG/C,MAAKa,MAAQ+B,EACb5C,KAAKT,GAAKO,EAAKP,GACfqD,EAAM9C,KAAOA,EACb8C,EAAMI,OAAShD,IACf,IAAIiD,GAAWJ,SAASK,eAAe,uBACvCD,GAASE,UAAY,GACrBF,EAASG,YAAYR,GACrB5C,KAAK2B,SAAU","file":"semapps-detail.min.js","sourcesContent":["Polymer({\r\n  is: 'semapps-detail',\r\n  properties: {\r\n    id: String,\r\n    title: String,\r\n    description: String,\r\n    queryParams: {\r\n      observer: '_queryChanged'\r\n    }\r\n  },\r\n\r\n  _queryChanged (data) {\r\n    \"use strict\";\r\n    if (data && data.uri) {\r\n      // Wait main object to be ready.\r\n      SemAppsCarto.ready(() => {\r\n        this.detailLoad(data.uri);\r\n      });\r\n    }\r\n  },\r\n\r\n  handleBack (e) {\r\n    \"use strict\";\r\n    e.preventDefault();\r\n    semapps.goSearch();\r\n  },\r\n\r\n  handleEdit(e) {\r\n    \"use strict\";\r\n    e.preventDefault();\r\n    let path = '/';\r\n    switch (semapps.entities[this.child.type].nameType) {\r\n      case 'organization':\r\n        path += 'mon-compte/organisation/form/' + this.id;\r\n        break;\r\n    }\r\n    window.location.replace(path);\r\n  },\r\n\r\n  attached () {\r\n    \"use strict\";\r\n    SemAppsCarto.ready(() => {\r\n      semapps.initElementGlobals(this);\r\n    });\r\n  },\r\n\r\n  detailLoad (encodedUri) {\r\n    \"use strict\";\r\n    if (window.location.pathname.indexOf(\"detail\") !== -1)\r\n        semapps.myRoute = \"detail\";\r\n\r\n    if( semapps.myRoute === \"detail\") {\r\n      // Show spinner.\r\n      this.loading = true;\r\n      // Hide content.\r\n      this.$.detail.style.display = 'none';\r\n      // Request server.\r\n      semapps.ajax('webservice/detail?uri=' + encodedUri, (data) => {\r\n          \"use strict\";\r\n          // Check that we are on the last callback expected.\r\n          this.detailLoadComplete(data)\r\n      });\r\n    }\r\n  },\r\n\r\n  detailLoadComplete (data) {\r\n    \"use strict\";\r\n    // Show detail content.\r\n    semapps.map.pinHideAll();\r\n    data = data.responseJSON.detail || {};\r\n    this.$.detail.style.display = '';\r\n    data.properties.image = semapps.imageOrFallback(data.properties.image, data.properties.type);\r\n    if(data.properties.address ){\r\n      let addressLabel = data.properties.address[0];\r\n      if(semapps.map.pins[data.uri]){\r\n        semapps.map.pinShowOne(data.uri);\r\n      }\r\n      else{\r\n        semapps.getAddressToCreatePoint(addressLabel,data.title,data.properties.type[0],data.uri)\r\n      }\r\n    }\r\n\r\n    let inner = document.createElement('semapps-detail-' + semapps.entities[data.properties.type].nameType.toLowerCase());\r\n    this.child = inner;\r\n    this.id = data.id;\r\n    inner.data = data;\r\n    inner.parent = this;\r\n    let domInner = document.getElementById('semapps-detail-inner');\r\n    domInner.innerHTML = '';\r\n    domInner.appendChild(inner);\r\n    this.loading = false;\r\n  }\r\n});\r\n"]}