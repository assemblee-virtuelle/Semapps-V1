{"version":3,"sources":["web/front/src/semapps-detail/semapps-detail.js"],"names":["Polymer","is","properties","id","String","title","description","queryParams","observer","_queryChanged","data","_this","this","uri","SemAppsCarto","ready","detailLoad","handleBack","e","preventDefault","semapps","goSearch","handleEdit","path","nameType","entities","child","type","encodeURI","encodeURIComponent","idOfGraph","currentComponentUri","ajax","log","window","location","replace","attached","_this2","initElementGlobals","encodedUri","_this3","myRoute","loading","$","detail","style","display","detailLoadComplete","scrollToContent","map","pinHideAll","responseJSON","image","imageOrFallback","key","address","addressLabel","pins","pinShowOne","getAddressToCreatePoint","inner","document","createElement","toLowerCase","isSameUri","user","arrayOfGraph","graph","split","isInGraph","graphuri","i","len","length","hasOwnProperty","canEdit","isSuperAdmin","parent","domInner","getElementById","innerHTML","appendChild"],"mappings":"YAAAA,UACEC,GAAI,iBACJC,YACEC,GAAIC,OACJC,MAAOD,OACPE,YAAaF,OACbG,aACEC,SAAU,kBAIdC,cAXM,SAWSC,GAAM,GAAAC,GAAAC,IAEfF,IAAQA,EAAKG,KAEfC,aAAaC,MAAM,WACjBJ,EAAKK,WAAWN,EAAKG,QAK3BI,WArBM,SAqBMC,GAEVA,EAAEC,iBACFC,QAAQC,YAGVC,WA3BM,SA2BKJ,GAETA,EAAEC,gBACF,IAAII,GAAO,IACPC,EAAWJ,QAAQK,SAASb,KAAKc,MAAMC,MAAMH,QACjD,QAAQA,GACN,IAAK,eACHD,GAAQ,gCAAkCK,UAAUC,mBAAmBjB,KAAKkB,WAC5E,MACF,KAAK,SACHP,GAAQ,wBACR,MACF,SACEA,GAAQ,wBAAwBC,EAAS,aAAaZ,KAAKmB,oBAG7DX,QAAQY,KAAK,6BAA+BJ,UAAUC,mBAAmBjB,KAAKkB,YAAa,SAACpB,GAGxFuB,IAAIvB,GACJwB,OAAOC,SAASC,QAAQb,MAKhCc,SApDM,WAoDM,GAAAC,GAAA1B,IAEVE,cAAaC,MAAM,WACjBK,QAAQmB,mBAARD,MAIJtB,WA3DM,SA2DMwB,GAAY,GAAAC,GAAA7B,IAIE,YAApBQ,QAAQsB,UAEV9B,KAAK+B,SAAU,EAEf/B,KAAKgC,EAAEC,OAAOC,MAAMC,QAAU,OAE9B3B,QAAQY,KAAK,yBAA2BQ,EAAY,SAAC9B,GAGjD+B,EAAKO,mBAAmBtC,OAKhCsC,mBA7EM,SA6EctC,GAQlB,GALAU,QAAQ6B,kBACR7B,QAAQ8B,IAAIC,aACZzC,EAAOA,EAAK0C,aAAaP,WACzBjC,KAAKgC,EAAEC,OAAOC,MAAMC,QAAU,GAC9BrC,EAAKR,WAAWmD,MAAQjC,QAAQkC,gBAAgB5C,EAAKR,WAAWmD,MAAO3C,EAAKR,WAAWqD,KACpF7C,EAAKR,WAAWsD,QAAS,CAC1B,GAAIC,GAAe/C,EAAKR,WAAWsD,QAAQ,EACxCpC,SAAQ8B,IAAIQ,KAAKhD,EAAKG,KACvBO,QAAQ8B,IAAIS,WAAWjD,EAAKG,KAG5BO,QAAQwC,wBAAwBH,EAAa/C,EAAKL,MAAMK,EAAKR,WAAWyB,KAAK,GAAGjB,EAAKG,KAGzF,GAAIgD,GAAQC,SAASC,cAAc,kBAAoB3C,QAAQK,SAASf,EAAKR,WAAWqD,KAAK/B,SAASwC,cACtGpD,MAAKc,MAAQmC,EACbjD,KAAKT,GAAKO,EAAKP,GACfS,KAAKqD,UAAavD,EAAKG,MAAQO,QAAQ8C,KAAKrD,GAC5C,IAAIsD,GAAgBzD,EAAKR,WAAWkE,MAAMC,MAAM,IAGhD,IAFAzD,KAAKkB,UAAY,KACjBlB,KAAK0D,WAAY,EACdlD,QAAQ8C,KAAKK,SACd,IAAK,GAAIC,GAAI,EAAGC,EAAMN,EAAaO,OAASF,EAAIC,IAAQ7D,KAAK0D,UAAWE,IACjEpD,QAAQ8C,KAAKK,SAASI,eAAeR,EAAaK,MACjD5D,KAAK0D,WAAW,EAChB1D,KAAKkB,UAAYV,QAAQ8C,KAAKK,SAASJ,EAAaK,IAAnC,UAO3B5D,MAAKgE,QAAYhE,KAAKqD,WAAarD,KAAK0D,WAAelD,QAAQyD,gBAAmF,iBAAjEzD,QAAQK,SAASf,EAAKR,WAAWqD,KAAK/B,SAASwC,cAChIH,EAAMnD,KAAOA,EACbmD,EAAMiB,OAASlE,KACfQ,QAAQyB,OAASjC,KACjBA,KAAKmB,oBAAsBrB,EAAKG,IAChCoB,IAAIb,QAAQyB,OAAO+B,QAEjB,IAAIG,GAAWjB,SAASkB,eAAe,uBACzCD,GAASE,UAAY,GACrBF,EAASG,YAAYrB,GACrBjD,KAAK+B,SAAU","file":"semapps-detail.min.js","sourcesContent":["Polymer({\n  is: 'semapps-detail',\n  properties: {\n    id: String,\n    title: String,\n    description: String,\n    queryParams: {\n      observer: '_queryChanged'\n    }\n  },\n\n  _queryChanged (data) {\n    \"use strict\";\n    if (data && data.uri) {\n      // Wait main object to be ready.\n      SemAppsCarto.ready(() => {\n        this.detailLoad(data.uri);\n      });\n    }\n  },\n\n  handleBack (e) {\n    \"use strict\";\n    e.preventDefault();\n    semapps.goSearch();\n  },\n\n  handleEdit(e) {\n    \"use strict\";\n    e.preventDefault();\n    let path = '/';\n    let nameType = semapps.entities[this.child.type].nameType;\n    switch (nameType) {\n      case 'organization':\n        path += 'mon-compte/organization/form/' + encodeURI(encodeURIComponent(this.idOfGraph));\n        break;\n      case 'person':\n        path += 'mon-compte/person/form';\n        break;\n      default:\n        path += 'mon-compte/component/'+nameType+'/form?uri='+this.currentComponentUri;\n\n    }\n      semapps.ajax('webservice/context/change/' + encodeURI(encodeURIComponent(this.idOfGraph)), (data) => {\n          \"use strict\";\n          // Check that we are on the last callback expected.\n          log(data);\n          window.location.replace(path);\n      });\n\n  },\n\n  attached () {\n    \"use strict\";\n    SemAppsCarto.ready(() => {\n      semapps.initElementGlobals(this);\n    });\n  },\n\n  detailLoad (encodedUri) {\n    \"use strict\";\n    // if (window.location.pathname.indexOf(\"detail\") !== -1)\n    //     semapps.myRoute = \"detail\";\n    if( semapps.myRoute === \"detail\") {\n      // Show spinner.\n      this.loading = true;\n      // Hide content.\n      this.$.detail.style.display = 'none';\n      // Request server.\n      semapps.ajax('webservice/detail?uri=' + encodedUri, (data) => {\n          \"use strict\";\n          // Check that we are on the last callback expected.\n          this.detailLoadComplete(data)\n      });\n    }\n  },\n\n  detailLoadComplete (data) {\n    \"use strict\";\n    // Show detail content.\n    semapps.scrollToContent();\n    semapps.map.pinHideAll();\n    data = data.responseJSON.detail || {};\n    this.$.detail.style.display = '';\n    data.properties.image = semapps.imageOrFallback(data.properties.image, data.properties.key);\n    if(data.properties.address ){\n      let addressLabel = data.properties.address[0];\n      if(semapps.map.pins[data.uri]){\n        semapps.map.pinShowOne(data.uri);\n      }\n      else{\n        semapps.getAddressToCreatePoint(addressLabel,data.title,data.properties.type[0],data.uri)\n      }\n    }\n    let inner = document.createElement('semapps-detail-' + semapps.entities[data.properties.key].nameType.toLowerCase());\n    this.child = inner;\n    this.id = data.id;\n    this.isSameUri = (data.uri === semapps.user.uri);\n    let arrayOfGraph  = data.properties.graph.split(\",\")\n    this.idOfGraph = null;\n    this.isInGraph = false;\n    if(semapps.user.graphuri){\n      for (let i = 0, len = arrayOfGraph.length ; i < len && !this.isInGraph; i++) {\n          if(semapps.user.graphuri.hasOwnProperty(arrayOfGraph[i])){\n              this.isInGraph =true;\n              this.idOfGraph = semapps.user.graphuri[arrayOfGraph[i]]['contextId']\n          }\n      }\n    }\n\n    //this.isInGraph = (data.properties.graph.indexOf(semapps.userGraphUri) !== -1);\n    //log(this.isInGraph);\n    this.canEdit = ((this.isSameUri || this.isInGraph) || (semapps.isSuperAdmin() && semapps.entities[data.properties.key].nameType.toLowerCase() === \"organization\"));\n    inner.data = data;\n    inner.parent = this;\n    semapps.detail = this;\n    this.currentComponentUri = data.uri;\n    log(semapps.detail.canEdit);\n\n      let domInner = document.getElementById('semapps-detail-inner');\n    domInner.innerHTML = '';\n    domInner.appendChild(inner);\n    this.loading = false;\n  }\n});\n"]}