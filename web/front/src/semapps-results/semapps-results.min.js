"use strict";Polymer({is:"semapps-results",properties:{tabFirst:{type:Object,value:{type:"all",plural:"Tous",icon:"list"}},typeSelected:{type:String},tabs:{type:Array,value:[]},tabsRegistry:{type:Object,value:{}},results:{type:Array,value:[]},searchLastTerm:{type:String,value:null},route:{type:Object,observer:"_routeChanged"}},attached:function(){var e=this;semapps.results=this,this.domSearchResults=semapps.domId("searchResults"),this.domLoadingSpinner=semapps.domId("searchLoadingSpinner"),this.$searchThemeFilter=$("#searchThemeFilter"),SemAppsCarto.ready(function(){var t=[],s="";$.each(semapps.entities,function(e,r){r.counter=0,s=""==s?e:s,t.push(r)}),e.tabs=t,e.selectType(s)})},tabRegister:function(e,t){this.tabsRegistry[e]=t,this.selectType(this.typeSelected)},selectType:function(e){this.selection(e),this.searchRender()},_routeChanged:function(e){var t=this;"/rechercher"===e.prefix&&window.SemAppsCarto.ready(function(){var s=e.path.split("/");log(s),t.search(s[1])})},search:function(e,t){var s=this,r=this.$searchThemeFilter.val();if(semapps.searchLastTerm===e&&semapps.searchLastFilter===r)return void this.searchRender();semapps.searchLastTerm=e=(e||"").replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),semapps.searchLastFilter=r,this.searchError=this.noResult=!1,this.results=[],this.domLoadingSpinner.style.display="block";var i=function(e){s.domLoadingSpinner.style.display="none",s.searchRender(e.responseJSON)};this.searchQueryLastComplete=i,semapps.ajax("webservice/search?term="+encodeURIComponent(e)+"&filter="+encodeURIComponent(semapps.searchLastFilter),function(e){i===s.searchQueryLastComplete&&i(e)})},searchRender:function(e){var t=this,s=[];this.searchError=this.noResult=!1,this.results.length=0,this.set("results",[]);var r=0,i={},a={};if(e=e||this.renderSearchResultResponse||{},this.renderSearchResultResponse=e,e.error)this.searchError=!0;else if(e.results){semapps.map.pinHideAll();var p=!0,n=!1,h=void 0;try{for(var l,c=e.results[Symbol.iterator]();!(p=(l=c.next()).done);p=!0){var o=l.value;semapps.entities[o.type]&&(i[o.type]=i[o.type]||0,i[o.type]++,r++,void 0===a[o.type]&&(a[o.type]=[]),a[o.type].push(o),o.address&&(void 0===semapps.map.pins[o.uri]?semapps.getAddressToCreatePoint(o.address,o.title,o.type,o.uri):semapps.map.pinShow(o.uri)))}}catch(e){n=!0,h=e}finally{try{!p&&c.return&&c.return()}finally{if(n)throw h}}if(void 0===a[this.typeSelected]){var u=Object.keys(a)[0];this.selection(u),s=void 0!==a[this.typeSelected]?a[Object.keys(a)[0]]:[]}else s=a[this.typeSelected];var y="";y+=s.length?s.length+" résultats ":"Aucun résultat  ",this.resultsTitle=y,this.noResult=0===s.length}this.tabsRegistry.all&&(this.tabsRegistry.all.counter=r);for(var d in semapps.entities)this.tabsRegistry[d]&&(this.tabsRegistry[d].counter=i[d]||0);setTimeout(function(){t.set("results",s)},100)},selection:function(e){this.typeSelected&&this.tabsRegistry[e]&&this.tabsRegistry[this.typeSelected].$$("li").classList.remove("active"),this.typeSelected=e,this.tabsRegistry[e]&&this.tabsRegistry[e].$$("li").classList.add("active")}});
//# sourceMappingURL=semapps-results.min.js.map
