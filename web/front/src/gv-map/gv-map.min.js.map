{"version":3,"sources":["web/front/src/gv-map/gv-map.js"],"names":["Polymer","is","properties","route","type","Object","observer","_routeChanged","this","updateVisibility","attached","_this","$gvMap","$","document","getElementById","$gvMapPins","$mapZones","find","hoverActive","window","gvmap","on","e","mapSelectBuilding","currentTarget","getAttribute","split","mapDeselectBuilding","key","gvc","buildingSelected","buildingSelectedAll","searchEvent","scrollToSearchResults","mapIsOver","mapSelectCurrent","zone","mapGetZone","classList","add","remove","mapSelectBuildingToggle","_this2","log","mapTimeout","clearTimeout","setTimeout","mapDeselectBuildingReset","method","each","index","mapShowBuildingPinAll","empty","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","keys","buildings","Symbol","iterator","next","done","i","value","mapShowBuildingPin","err","return","buildingKey","pin","createElement","building","append","mainComponent","get","addClass","removeClass"],"mappings":"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","file":"gv-map.min.js","sourcesContent":["Polymer({\n  is: 'gv-map',\n\n  properties: {\n    route: {\n      type: Object,\n      observer: '_routeChanged'\n    }\n  },\n\n  _routeChanged: function () {\n    this.updateVisibility();\n  },\n\n  // Wait all HTML to be loaded.\n  attached() {\n    this.$gvMap = $(document.getElementById('gv-map'));\n    this.$gvMapPins = $(document.getElementById('gv-map-pins'));\n    this.$mapZones = this.$gvMap.find('.mapZone');\n    this.hoverActive = true;\n    // Global ref.\n    window.gvmap = this;\n    // Bind events.\n    this.$mapZones\n      .on('mouseover', (e) => {\n        this.hoverActive && this.mapSelectBuilding(e.currentTarget.getAttribute('id').split('-')[1]);\n      })\n      .on('mouseout', (e) => {\n        this.hoverActive && this.mapDeselectBuilding(e.currentTarget.getAttribute('id').split('-')[1]);\n      })\n      // Click.\n      .on('click', (e) => {\n        let key = e.currentTarget.getAttribute('id').split('-')[1];\n        key = key !== window.gvc.buildingSelected ? key : gvc.buildingSelectedAll;\n        // Set value to current select.\n        window.gvc.buildingSelected = key;\n        // Display.\n        this.mapSelectBuilding(key);\n        // Search.\n        window.gvc.searchEvent();\n        this.hoverActive = false;\n        // Scroll.\n        window.gvc.scrollToSearchResults(() => {\n          \"use strict\";\n          this.hoverActive = true;\n        });\n      });\n\n    this.updateVisibility();\n  },\n\n  mapSelectBuilding(key) {\n    // Deselect if already selected.\n    this.mapDeselectBuilding();\n    this.mapIsOver = true;\n    gvc.buildingSelected =\n      this.mapSelectCurrent = key;\n    let zone = this.mapGetZone(this.mapSelectCurrent);\n    if (zone) {\n      zone.classList.add('strong');\n      zone.classList.remove('discreet');\n      // Hide all.\n      this.mapSelectBuildingToggle(true);\n    }\n    else {\n      // Display all.\n      this.mapSelectBuildingToggle(false);\n    }\n  },\n\n  mapDeselectBuilding() {\n    log(this.mapSelectCurrent);\n    if (this.mapSelectCurrent) {\n      this.mapGetZone(this.mapSelectCurrent).classList.remove('strong');\n      delete this.mapSelectCurrent;\n    }\n    if (this.mapTimeout) {\n      clearTimeout(this.mapTimeout);\n    }\n    this.mapIsOver = false;\n    this.mapTimeout = setTimeout(() => {\n      // Mouse is still not over.\n      if (!this.mapIsOver) {\n        this.mapDeselectBuildingReset();\n      }\n    }, 500);\n  },\n\n  mapDeselectBuildingReset() {\n    this.mapTimeout = false;\n    this.mapSelectBuildingToggle(false);\n  },\n\n  mapSelectBuildingToggle(add) {\n    // Define add or remove class.\n    var method = add ? 'add' : 'remove';\n    this.$mapZones.each((index, zone) => {\n      // On all paths.\n      zone.classList[method]('discreet');\n    });\n  },\n\n  mapGetZone(key) {\n    return document.getElementById('mapZone-' + key);\n  },\n\n  mapShowBuildingPinAll() {\n    \"use strict\";\n    this.$gvMapPins.empty();\n    for (let i of Object.keys(gvc.buildings)) {\n      this.mapShowBuildingPin(gvc.buildings[i].key);\n    }\n  },\n\n  mapShowBuildingPin(buildingKey) {\n    if (buildingKey !== gvc.buildingSelectedAll) {\n      let pin = document.createElement('gv-map-pin');\n      pin.building = buildingKey;\n      this.$gvMapPins.append(pin);\n    }\n  },\n\n  updateVisibility() {\n    \"use strict\";\n    switch (gvc.mainComponent.get('route.path').split('/')[1]) {\n      case 'detail':\n        // Hide.\n        this.$gvMap.addClass('fadeOut').removeClass('fadeIn');\n        break;\n      default:\n        // Show.\n        this.$gvMap.addClass('fadeIn').removeClass('fadeOut');\n        break;\n    }\n  }\n});\n"]}