{"version":3,"sources":["web/front/src/gv-map/gv-map.js"],"names":["Polymer","is","properties","route","type","Object","observer","_routeChanged","this","updateVisibility","attached","_this","$gvMap","$","document","getElementById","$gvMapPins","$mapZones","find","hoverActive","domPins","window","gvmap","on","e","mapSelectBuilding","currentTarget","getAttribute","split","mapDeselectBuilding","key","gvc","buildingSelected","buildingSelectedAll","searchEvent","scrollToSearchResults","ready","GVCarto","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","keys","buildings","Symbol","iterator","next","done","buildingKey","value","pin","createElement","building","append","err","return","mapIsOver","mapSelectCurrent","zone","mapGetZone","classList","add","remove","mapSelectBuildingToggle","_this2","mapTimeout","clearTimeout","setTimeout","mapDeselectBuildingReset","method","each","index","mapShowBuildingPinAll","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","organizationCount","show","mapHideBuildingPinAll","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","hide","mapHideBuildingPin","mainComponent","get","addClass","removeClass"],"mappings":"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","file":"gv-map.min.js","sourcesContent":["Polymer({\r\n  is: 'gv-map',\r\n\r\n  properties: {\r\n    route: {\r\n      type: Object,\r\n      observer: '_routeChanged'\r\n    }\r\n  },\r\n\r\n  _routeChanged: function () {\r\n    this.updateVisibility();\r\n  },\r\n\r\n  // Wait all HTML to be loaded.\r\n  attached() {\r\n    this.$gvMap = $(document.getElementById('gv-map'));\r\n    this.$gvMapPins = $(document.getElementById('gv-map-pins'));\r\n    this.$mapZones = this.$gvMap.find('.mapZone');\r\n    this.hoverActive = true;\r\n    this.domPins = {};\r\n    // Global ref.\r\n    window.gvmap = this;\r\n    // Bind events.\r\n    this.$mapZones\r\n      .on('mouseover', (e) => {\r\n        this.hoverActive && this.mapSelectBuilding(e.currentTarget.getAttribute('id').split('-')[1]);\r\n      })\r\n      .on('mouseout', (e) => {\r\n        this.hoverActive && this.mapDeselectBuilding(e.currentTarget.getAttribute('id').split('-')[1]);\r\n      })\r\n      // Click.\r\n      .on('click', (e) => {\r\n        let key = e.currentTarget.getAttribute('id').split('-')[1];\r\n        key = key !== window.gvc.buildingSelected ? key : gvc.buildingSelectedAll;\r\n        // Set value to current select.\r\n        window.gvc.buildingSelected = key;\r\n        // Display.\r\n        this.mapSelectBuilding(key);\r\n        // Search.\r\n        window.gvc.searchEvent();\r\n        this.hoverActive = false;\r\n        // Scroll.\r\n        window.gvc.scrollToSearchResults(() => {\r\n          \"use strict\";\r\n          this.hoverActive = true;\r\n        });\r\n      });\r\n\r\n    this.ready = false;\r\n\r\n    // Wait for buildings to be loaded.\r\n    GVCarto.ready(() => {\r\n      \"use strict\";\r\n      this.ready = true;\r\n      // Create pins.\r\n      for (let buildingKey of Object.keys(gvc.buildings)) {\r\n        let pin = document.createElement('gv-map-pin');\r\n        pin.building = buildingKey;\r\n        this.$gvMapPins.append(pin);\r\n        this.domPins[buildingKey] = pin;\r\n      }\r\n      this.updateVisibility();\r\n    });\r\n  },\r\n\r\n  mapSelectBuilding(key) {\r\n    // Deselect if already selected.\r\n    this.mapDeselectBuilding();\r\n    this.mapIsOver = true;\r\n    gvc.buildingSelected =\r\n      this.mapSelectCurrent = key;\r\n    let zone = this.mapGetZone(this.mapSelectCurrent);\r\n    if (zone) {\r\n      zone.classList.add('strong');\r\n      zone.classList.remove('discreet');\r\n      // Hide all.\r\n      this.mapSelectBuildingToggle(true);\r\n    }\r\n    else {\r\n      // Display all.\r\n      this.mapSelectBuildingToggle(false);\r\n    }\r\n  },\r\n\r\n  mapDeselectBuilding() {\r\n    if (this.mapSelectCurrent) {\r\n      this.mapGetZone(this.mapSelectCurrent).classList.remove('strong');\r\n      delete this.mapSelectCurrent;\r\n    }\r\n    if (this.mapTimeout) {\r\n      clearTimeout(this.mapTimeout);\r\n    }\r\n    this.mapIsOver = false;\r\n    this.mapTimeout = setTimeout(() => {\r\n      // Mouse is still not over.\r\n      if (!this.mapIsOver) {\r\n        this.mapDeselectBuildingReset();\r\n      }\r\n    }, 500);\r\n  },\r\n\r\n  mapDeselectBuildingReset() {\r\n    this.mapTimeout = false;\r\n    this.mapSelectBuildingToggle(false);\r\n  },\r\n\r\n  mapSelectBuildingToggle(add) {\r\n    // Define add or remove class.\r\n    var method = add ? 'add' : 'remove';\r\n    this.$mapZones.each((index, zone) => {\r\n      // On all paths.\r\n      zone.classList[method]('discreet');\r\n    });\r\n  },\r\n\r\n  mapGetZone(key) {\r\n    return document.getElementById('mapZone-' + key);\r\n  },\r\n\r\n  mapShowBuildingPinAll() {\r\n    \"use strict\";\r\n    if (this.ready) {\r\n      for (let buildingKey of Object.keys(gvc.buildings)) {\r\n        if (gvc.buildings[buildingKey].organizationCount > 0) {\r\n          this.domPins[buildingKey].show(gvc.buildings[buildingKey].organizationCount);\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  mapHideBuildingPinAll() {\r\n    \"use strict\";\r\n    if (this.ready) {\r\n      for (let buildingKey of Object.keys(gvc.buildings)) {\r\n        this.domPins[buildingKey].hide();\r\n      }\r\n    }\r\n  },\r\n\r\n  mapHideBuildingPin(buildingKey) {\r\n    if (this.domPins[buildingKey]) {\r\n      this.domPins[buildingKey].hide();\r\n    }\r\n  },\r\n\r\n  updateVisibility() {\r\n    \"use strict\";\r\n    switch (gvc.mainComponent.get('route.path').split('/')[1]) {\r\n      case 'detail':\r\n        // Hide.\r\n        this.$gvMap.addClass('fadeOut').removeClass('fadeIn');\r\n        break;\r\n      default:\r\n        // Show.\r\n        this.$gvMap.addClass('fadeIn').removeClass('fadeOut');\r\n        break;\r\n    }\r\n  }\r\n});\r\n"]}