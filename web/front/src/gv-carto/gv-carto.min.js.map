{"version":3,"sources":["web/front/src/gv-carto/gv-carto.js"],"names":["Polymer","is","ready","window","log","m","console","gvc","this","$window","$","buildingSelected","location","hostname","document","body","classList","add","ajaxMultiple","buildings","start","sources","callback","ajaxCounter","allData","self","key","ajax","url","complete","e","JSON","parse","responseText","call","data","_this","domSearchTextInput","domId","domSearchResults","stateSet","callbackSearchEvent","searchEvent","bind","listen","scrollToSearch","stateName","stateCurrent","nameCapitalized","charAt","toUpperCase","slice","nameCurrentCapitalized","stateWaitingInit","stateWaitingExit","stateSearchInit","value","stateSearchExit","scrollTo","duration","easing","preventDefault","term","search","building","_this2","arguments","length","undefined","innerHTML","encodeURIComponent","dataType","renderSearchResult","responseJSON","results","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","result","createElement","title","description","uri","appendChild","err","return","id","event","Array","isArray","addEventListener","i","getElementById","dom","selector","querySelectorAll"],"mappings":"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","file":"gv-carto.min.js","sourcesContent":["Polymer({\n  is: 'gv-carto',\n  ready() {\n    \"use strict\";\n\n    // Devel\n    window.log = (m) => {\n      console.log(m);\n    };\n\n    window.gvc = this;\n\n    this.$window = $(window);\n    this.buildingSelected = 'all';\n\n    // Special class for dev env.\n    if (window.location.hostname === '127.0.0.1') {\n      window.document.body.classList.add('dev-env');\n    }\n\n    this.ajaxMultiple({\n      buildings: 'webservice/building'\n    }, this.start);\n  },\n\n  ajaxMultiple(sources, callback) {\n    \"use strict\";\n    var ajaxCounter = 0;\n    var allData = {};\n    var self = this;\n    for (var key in sources) {\n      ajaxCounter++;\n      $.ajax({\n        url: sources[key],\n        complete: function (key) {\n          return function (e) {\n            ajaxCounter--;\n            allData[key] = JSON.parse(e.responseText);\n            // Final callback.\n            if (ajaxCounter === 0) {\n              callback.call(self, allData);\n            }\n          }\n        }(key)\n      });\n    }\n  },\n\n  start(data) {\n    \"use strict\";\n    this.buildings = data.buildings;\n    // Shortcuts.\n    this.domSearchTextInput = this.domId('searchText');\n    this.domSearchResults = this.domId('searchResults');\n    this.stateSet('waiting');\n\n    // Listeners.\n    var callbackSearchEvent = this.searchEvent.bind(this);\n    // Click on submit button.\n    this.listen('searchForm', 'submit', (e) => {\n      this.scrollToSearch();\n      callbackSearchEvent(e);\n    });\n    // Type in search field.\n    this.listen('searchText', 'keyup', callbackSearchEvent);\n  },\n\n  stateSet(stateName) {\n    if (this.stateCurrent !== stateName) {\n      let nameCapitalized = stateName.charAt(0).toUpperCase() + stateName.slice(1);\n      if (this.stateCurrent) {\n        let nameCurrentCapitalized = this.stateCurrent.charAt(0).toUpperCase() + this.stateCurrent.slice(1);\n        this['state' + nameCurrentCapitalized + 'Exit']();\n        this.stateCurrent = null;\n      }\n      // Callback should not return false if success.\n      if (this['state' + nameCapitalized + 'Init']() !== false) {\n        this.stateCurrent = stateName;\n      }\n    }\n  },\n\n  /* -- Waiting --*/\n  stateWaitingInit() {\n\n  },\n\n  stateWaitingExit() {\n\n  },\n\n  /* -- Search -- */\n\n  stateSearchInit() {\n    if (!this.domSearchTextInput.value) {\n      this.stateSet('waiting');\n      // Block saving current state.\n      return false;\n    }\n  },\n\n  stateSearchExit() {\n\n  },\n  scrollToSearch() {\n    this.$window.scrollTo('#searchTabs', {\n      duration: 1000,\n      easing: 'easeOutQuad'\n    });\n  },\n\n  searchEvent(e) {\n    // Event may be missing.\n    e && e.preventDefault();\n    var term = this.domSearchTextInput.value;\n    this.search(term, {\n      building: this.buildingSelected\n    });\n  },\n\n  search(term, options = {}) {\n    this.stateSet('search');\n\n    // Empty content.\n    this.domSearchResults.innerHTML = '';\n\n    $.ajax({\n      url: 'webservice/search?t=' + encodeURIComponent(term),\n      dataType: 'json',\n      complete: (data) => {\n        this.renderSearchResult(data.responseJSON);\n      }\n    });\n  },\n\n  renderSearchResult(results) {\n    \"use strict\";\n    for (let data of results) {\n      let result = document.createElement('gv-results-item');\n      result.title = data.title;\n      result.description = data.description;\n      result.uri = data.uri;\n      this.domSearchResults.appendChild(result);\n    }\n  },\n\n  listen(id, event, callback) {\n    // Support list of events names.\n    if (Array.isArray(event)) {\n      for (let i in event) {\n        this.listen(id, event[i], callback);\n      }\n      return;\n    }\n    return this.domId(id).addEventListener(event, callback);\n  },\n\n  domId(id) {\n    return document.getElementById(id);\n  },\n\n  dom(selector) {\n    return document.querySelectorAll(selector);\n  }\n\n});\n"]}