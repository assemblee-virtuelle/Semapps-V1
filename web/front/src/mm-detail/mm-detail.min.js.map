{"version":3,"sources":["web/front/src/mm-detail/mm-detail.js"],"names":["Polymer","is","properties","id","String","title","description","queryParams","observer","_queryChanged","data","_this","this","uri","GVCarto","ready","detailLoad","handleBack","e","preventDefault","gvc","goSearch","handleEdit","path","searchTypes","child","type","window","location","replace","attached","_this2","initElementGlobals","encodedUri","_this3","myRoute","loading","$","detail","style","display","ajax","detailLoadComplete","responseJSON","log","image","imageOrFallback","building","map","pinShowOne","inner","document","createElement","toLowerCase","parent","domInner","getElementById","innerHTML","appendChild"],"mappings":"YAAAA,UACEC,GAAI,YACJC,YACEC,GAAIC,OACJC,MAAOD,OACPE,YAAaF,OACbG,aACEC,SAAU,kBAIdC,cAXM,SAWSC,GAAM,GAAAC,GAAAC,IAEfF,IAAQA,EAAKG,KAEfC,QAAQC,MAAM,WACZJ,EAAKK,WAAWN,EAAKG,QAK3BI,WArBM,SAqBMC,GAEVA,EAAEC,iBACFC,IAAIC,YAGNC,WA3BM,SA2BKJ,GAETA,EAAEC,gBACF,IAAII,GAAO,GACX,QAAQH,IAAII,YAAYZ,KAAKa,MAAMC,MAAMA,MACvC,IAAK,eACHH,GAAQ,eAAiBX,KAAKT,GAGlCwB,OAAOC,SAASC,QAAQN,IAG1BO,SAvCM,WAuCM,GAAAC,GAAAnB,IAEVE,SAAQC,MAAM,WACZK,IAAIY,mBAAJD,MAIJf,WA9CM,SA8CMiB,GAAY,GAAAC,GAAAtB,IAEF,YAAhBQ,IAAIe,UAENvB,KAAKwB,SAAU,EAEfxB,KAAKyB,EAAEC,OAAOC,MAAMC,QAAU,OAE9BpB,IAAIqB,KAAK,yBAA2BR,EAAY,SAACvB,GAG7CwB,EAAKQ,mBAAmBhC,OAKhCgC,mBA9DM,SA8DchC,GAGlBA,EAAOA,EAAKiC,aAAaL,WACzBM,IAAIlC,GACJE,KAAKyB,EAAEC,OAAOC,MAAMC,QAAU,GAC9B9B,EAAKR,WAAW2C,MAAQzB,IAAI0B,gBAAgBpC,EAAKR,WAAW2C,MAAOnC,EAAKR,WAAWwB,MAC/EhB,EAAKR,WAAW6C,SAElB3B,IAAI4B,IAAIC,WAAWvC,EAAKR,WAAW6C,SAAU,OACrCrC,EAAKqC,UACb3B,IAAI4B,IAAIC,WAAWvC,EAAKqC,SAAU,MAIpC,IAAIG,GAAQC,SAASC,cAAc,aAAehC,IAAII,YAAYd,EAAKR,WAAWwB,MAAMA,KAAK2B,cAC7FzC,MAAKa,MAAQyB,EACbtC,KAAKT,GAAKO,EAAKP,GACf+C,EAAMxC,KAAOA,EACbwC,EAAMI,OAAS1C,IACf,IAAI2C,GAAWJ,SAASK,eAAe,kBACvCD,GAASE,UAAY,GACrBF,EAASG,YAAYR,GACrBtC,KAAKwB,SAAU","file":"mm-detail.min.js","sourcesContent":["Polymer({\r\n  is: 'mm-detail',\r\n  properties: {\r\n    id: String,\r\n    title: String,\r\n    description: String,\r\n    queryParams: {\r\n      observer: '_queryChanged'\r\n    }\r\n  },\r\n\r\n  _queryChanged (data) {\r\n    \"use strict\";\r\n    if (data && data.uri) {\r\n      // Wait main object to be ready.\r\n      GVCarto.ready(() => {\r\n        this.detailLoad(data.uri);\r\n      });\r\n    }\r\n  },\r\n\r\n  handleBack (e) {\r\n    \"use strict\";\r\n    e.preventDefault();\r\n    gvc.goSearch();\r\n  },\r\n\r\n  handleEdit(e) {\r\n    \"use strict\";\r\n    e.preventDefault();\r\n    let path = '/';\r\n    switch (gvc.searchTypes[this.child.type].type) {\r\n      case 'organization':\r\n        path += 'orga/detail/' + this.id;\r\n        break;\r\n    }\r\n    window.location.replace(path);\r\n  },\r\n\r\n  attached () {\r\n    \"use strict\";\r\n    GVCarto.ready(() => {\r\n      gvc.initElementGlobals(this);\r\n    });\r\n  },\r\n\r\n  detailLoad (encodedUri) {\r\n    \"use strict\";\r\n    if( gvc.myRoute === \"detail\") {\r\n      // Show spinner.\r\n      this.loading = true;\r\n      // Hide content.\r\n      this.$.detail.style.display = 'none';\r\n      // Request server.\r\n      gvc.ajax('webservice/detail?uri=' + encodedUri, (data) => {\r\n          \"use strict\";\r\n          // Check that we are on the last callback expected.\r\n          this.detailLoadComplete(data)\r\n      });\r\n    }\r\n  },\r\n\r\n  detailLoadComplete (data) {\r\n    \"use strict\";\r\n    // Show detail content.\r\n    data = data.responseJSON.detail || {};\r\n    log(data);\r\n    this.$.detail.style.display = '';\r\n    data.properties.image = gvc.imageOrFallback(data.properties.image, data.properties.type);\r\n    if (data.properties.building) {\r\n      // Display building on the map.\r\n      gvc.map.pinShowOne(data.properties.building, 'ICI');\r\n    }else if (data.building){\r\n      gvc.map.pinShowOne(data.building, 'ICI');\r\n    }\r\n\r\n    // Create inner depending of type.\r\n    let inner = document.createElement('mm-detail-' + gvc.searchTypes[data.properties.type].type.toLowerCase());\r\n    this.child = inner;\r\n    this.id = data.id;\r\n    inner.data = data;\r\n    inner.parent = this;\r\n    let domInner = document.getElementById('mm-detail-inner');\r\n    domInner.innerHTML = '';\r\n    domInner.appendChild(inner);\r\n    this.loading = false;\r\n  }\r\n});\r\n"]}