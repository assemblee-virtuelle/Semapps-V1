"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}();!function(){window.log=function(e){console.log(e)};var e=[];window.GVCarto=function(){function t(e){_classCallCheck(this,t),window.gvc=this,this.mainComponent=e,this.firstSearch=!0,this.$window=$(window),this.buildingSelected="partout","127.0.0.1"===window.location.hostname&&window.document.body.classList.add("dev-env"),this.ajaxMultiple({buildings:"/webservice/building"},this.start)}return _createClass(t,[{key:"ajaxMultiple",value:function(e,t){var s=0,i={},n=this;for(var r in e)s++,$.ajax({url:e[r],complete:function(e){return function(r){s--,i[e]=JSON.parse(r.responseText),0===s&&t.call(n,i)}}(r)})}},{key:"start",value:function(t){var s=this;this.buildings=t.buildings,this.domSearchTextInput=this.domId("searchText"),this.domSearchResults=this.domId("searchResults"),this.stateSet("waiting");var i=this.searchEvent.bind(this);this.listen("searchForm","submit",function(e){s.domSearchTextInput.blur(),s.scrollToSearchResults(),i(e)}),this.isReady=!0;var n;this.listen("searchText","keyup",function(){n&&window.clearTimeout(n),n=window.setTimeout(i,500)});for(var r in e)e[r]()}},{key:"stateSet",value:function(e){if(this.stateCurrent!==e){var t=e.charAt(0).toUpperCase()+e.slice(1);if(this.stateCurrent){var s=this.stateCurrent.charAt(0).toUpperCase()+this.stateCurrent.slice(1);this["state"+s+"Exit"](),this.stateCurrent=null}this["state"+t+"Init"]()!==!1&&(this.stateCurrent=e)}}},{key:"stateWaitingInit",value:function(){}},{key:"stateWaitingExit",value:function(){}},{key:"stateSearchInit",value:function(){if(!this.domSearchTextInput.value)return this.stateSet("waiting"),!1}},{key:"stateSearchExit",value:function(){}},{key:"scrollToSearchResults",value:function(e){this.$window.scrollTo($("#searchTabs").offset().top-150,{duration:1e3,easing:"easeOutQuad",complete:e})}},{key:"searchEvent",value:function(e){e&&e.preventDefault();var t=this.domSearchTextInput.value;this.search(t,this.buildingSelected)}},{key:"searchRouteChange",value:function(e,t){this.firstSearch&&(this.domSearchTextInput.value=e,this.buildingSelected="building",this.firstSearch=!1),this.search(e,t)}},{key:"search",value:function(e,t){var s=this;if(this.stateSet("search"),this.lastSearchTerm!==e||this.lastSearchBuilding!==t){this.lastSearchTerm=e,this.lastSearchBuilding=t,this.mainComponent.set("route.path","/rechercher/"+(t||"partout")+"/"+e),this.domId("searchResults"),this.domSearchResults.innerHTML="",$("#gv-results-empty, #gv-results-error").hide();var i=$("#gv-spinner"),n=function(e){i.hide(),s.renderSearchResult(e.responseJSON)};this.searchQueryLastComplete=n,i.show(),$.ajax({url:"/webservice/search?b="+encodeURIComponent(t)+"&t="+encodeURIComponent(e),dataType:"json",complete:function(e){n===s.searchQueryLastComplete&&n(e)}})}}},{key:"renderSearchResult",value:function(e){if(e.error)$("#gv-results-error").show();else if(e.results.length)for(var t in e.results){var s=e.results[t],i=document.createElement("gv-results-item");i.label=s.label,i.uri=s.uri,this.domSearchResults.appendChild(i)}else $("#gv-results-empty").show()}},{key:"listen",value:function(e,t,s){if(!Array.isArray(t))return this.domId(e).addEventListener(t,s);for(var i in t)this.listen(e,t[i],s)}},{key:"domId",value:function(e){return document.getElementById(e)}},{key:"dom",value:function(e){return document.querySelectorAll(e)}}]),t}(),window.GVCarto.ready=function(t){window.gvc&&window.gvc.isReady?t():e.push(t)}}();
//# sourceMappingURL=main.min.js.map
