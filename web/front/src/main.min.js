"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){window.log=function(e){console.log(e)};var e=[];window.GVCarto=function(){function t(e){_classCallCheck(this,t),window.gvc=this,this.mainComponent=e,this.firstSearch=!0,this.$window=$(window),this.buildingSelected="partout",this.$loadingSpinner=$("#gv-spinner"),"127.0.0.1"===window.location.hostname&&window.document.body.classList.add("dev-env"),this.ajaxMultiple({buildings:"/webservice/building"},this.start)}return _createClass(t,[{key:"ajaxMultiple",value:function(e,t){var n=0,i={},s=this;for(var a in e)n++,$.ajax({url:e[a],complete:function(e){return function(a){n--,i[e]=JSON.parse(a.responseText),0===n&&t.call(s,i)}}(a)})}},{key:"start",value:function(t){var n=this;this.buildings=t.buildings,this.domSearchTextInput=this.domId("searchText"),this.domSearchResults=this.domId("searchResults"),this.stateSet("waiting");var i=this.searchEvent.bind(this);this.listen("searchForm","submit",function(e){n.domSearchTextInput.blur(),n.scrollToSearchResults(),i(e)}),this.isReady=!0;var s;this.listen("searchText","keyup",function(){s&&window.clearTimeout(s),s=window.setTimeout(i,500)});for(var a in e)e[a]()}},{key:"stateSet",value:function(e){if(this.stateCurrent!==e){var t=e.charAt(0).toUpperCase()+e.slice(1);if(this.stateCurrent){var n=this.stateCurrent.charAt(0).toUpperCase()+this.stateCurrent.slice(1);this["state"+n+"Exit"](),this.stateCurrent=null}this["state"+t+"Init"]()!==!1&&(this.stateCurrent=e)}}},{key:"loadingPageContentStart",value:function(){this.$loadingSpinner.show()}},{key:"loadingPageContentStop",value:function(){this.$loadingSpinner.hide()}},{key:"stateWaitingInit",value:function(){}},{key:"stateWaitingExit",value:function(){}},{key:"stateSearchInit",value:function(){if(!this.domSearchTextInput.value)return this.stateSet("waiting"),!1}},{key:"stateSearchExit",value:function(){}},{key:"scrollToSearchResults",value:function(e){this.$window.scrollTo($("#searchTabs").offset().top-150,{duration:1e3,easing:"easeOutQuad",complete:e})}},{key:"searchEvent",value:function(e){e&&e.preventDefault();var t=this.domSearchTextInput.value;this.search(t,this.buildingSelected)}},{key:"searchRouteChange",value:function(e,t){this.firstSearch&&(this.domSearchTextInput.value=e,this.buildingSelected="building",this.firstSearch=!1),this.search(e,t)}},{key:"textRemove",value:function(e,t){return e.replace(new RegExp(t,"g"),"")}},{key:"search",value:function(e,t){var n=this;if(this.stateSet("search"),e=e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),this.lastSearchTerm!==e||this.lastSearchBuilding!==t){this.lastSearchTerm=e,this.lastSearchBuilding=t,this.mainComponent.set("route.path","/rechercher/"+(t||"partout")+"/"+e),this.domId("searchResults"),this.domSearchResults.innerHTML="",$("#gv-results-empty, #gv-results-error").hide(),this.loadingPageContentStart();var i=function(e){n.loadingPageContentStop(),n.renderSearchResult(e.responseJSON)};this.searchQueryLastComplete=i,this.loadingPageContentStart(),$.ajax({url:"/webservice/search?b="+encodeURIComponent(t)+"&t="+encodeURIComponent(e),dataType:"json",complete:function(e){i===n.searchQueryLastComplete&&i(e)}})}}},{key:"renderSearchResult",value:function(e){if(e.error)$("#gv-results-error").show();else if(e.results.length)for(var t in e.results){var n=e.results[t],i=document.createElement("gv-results-item");i.label=n.label,i.uri=n.uri,this.domSearchResults.appendChild(i)}else $("#gv-results-empty").show()}},{key:"listen",value:function(e,t,n){if(!Array.isArray(t))return this.domId(e).addEventListener(t,n);for(var i in t)this.listen(e,t[i],n)}},{key:"domId",value:function(e){return document.getElementById(e)}},{key:"dom",value:function(e){return document.querySelectorAll(e)}}]),t}(),window.GVCarto.ready=function(t){window.gvc&&window.gvc.isReady?t():e.push(t)}}();
//# sourceMappingURL=main.min.js.map
