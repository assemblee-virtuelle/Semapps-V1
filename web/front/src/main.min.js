"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();!function(){window.log=function(e){console.log(e)};var e=[];window.GVCarto=function(){function t(e){_classCallCheck(this,t),window.gvc=this,this.mainComponent=e,this.firstSearch=!0,this.$window=$(window),this.buildingSelected="partout","127.0.0.1"===window.location.hostname&&window.document.body.classList.add("dev-env"),this.ajaxMultiple({buildings:"/webservice/building"},this.start)}return _createClass(t,[{key:"ajaxMultiple",value:function(e,t){var i=0,s={},n=this;for(var r in e)i++,$.ajax({url:e[r],complete:function(e){return function(r){i--,s[e]=JSON.parse(r.responseText),0===i&&t.call(n,s)}}(r)})}},{key:"start",value:function(t){var i=this;this.buildings=t.buildings,this.domSearchTextInput=this.domId("searchText"),this.domSearchResults=this.domId("searchResults"),this.stateSet("waiting");var s=this.searchEvent.bind(this);this.listen("searchForm","submit",function(e){i.domSearchTextInput.blur(),i.scrollToSearchResults(),s(e)}),this.isReady=!0;var n;this.listen("searchText","keyup",function(){n&&window.clearTimeout(n),n=window.setTimeout(s,500)});for(var r in e)e[r]()}},{key:"stateSet",value:function(e){if(this.stateCurrent!==e){var t=e.charAt(0).toUpperCase()+e.slice(1);if(this.stateCurrent){var i=this.stateCurrent.charAt(0).toUpperCase()+this.stateCurrent.slice(1);this["state"+i+"Exit"](),this.stateCurrent=null}this["state"+t+"Init"]()!==!1&&(this.stateCurrent=e)}}},{key:"stateWaitingInit",value:function(){}},{key:"stateWaitingExit",value:function(){}},{key:"stateSearchInit",value:function(){if(!this.domSearchTextInput.value)return this.stateSet("waiting"),!1}},{key:"stateSearchExit",value:function(){}},{key:"scrollToSearchResults",value:function(e){this.$window.scrollTo($("#searchTabs").offset().top-150,{duration:1e3,easing:"easeOutQuad",complete:e})}},{key:"searchEvent",value:function(e){e&&e.preventDefault();var t=this.domSearchTextInput.value;this.search(t,this.buildingSelected)}},{key:"searchRouteChange",value:function(e,t){this.firstSearch&&(this.domSearchTextInput.value=e,this.buildingSelected="building",this.firstSearch=!1),this.search(e,t)}},{key:"textRemove",value:function(e,t){return e.replace(new RegExp(t,"g"),"")}},{key:"search",value:function(e,t){var i=this;if(this.stateSet("search"),e=e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),this.lastSearchTerm!==e||this.lastSearchBuilding!==t){this.lastSearchTerm=e,this.lastSearchBuilding=t,this.mainComponent.set("route.path","/rechercher/"+(t||"partout")+"/"+e),this.domId("searchResults"),this.domSearchResults.innerHTML="",$("#gv-results-empty, #gv-results-error").hide();var s=$("#gv-spinner"),n=function(e){s.hide(),i.renderSearchResult(e.responseJSON)};this.searchQueryLastComplete=n,s.show(),$.ajax({url:"/webservice/search?b="+encodeURIComponent(t)+"&t="+encodeURIComponent(e),dataType:"json",complete:function(e){n===i.searchQueryLastComplete&&n(e)}})}}},{key:"renderSearchResult",value:function(e){if(e.error)$("#gv-results-error").show();else if(e.results.length)for(var t in e.results){var i=e.results[t],s=document.createElement("gv-results-item");s.label=i.label,s.uri=i.uri,this.domSearchResults.appendChild(s)}else $("#gv-results-empty").show()}},{key:"listen",value:function(e,t,i){if(!Array.isArray(t))return this.domId(e).addEventListener(t,i);for(var s in t)this.listen(e,t[s],i)}},{key:"domId",value:function(e){return document.getElementById(e)}},{key:"dom",value:function(e){return document.querySelectorAll(e)}},{key:"detailLoad",value:function(e){}}]),t}(),window.GVCarto.ready=function(t){window.gvc&&window.gvc.isReady?t():e.push(t)}}();
//# sourceMappingURL=main.min.js.map
