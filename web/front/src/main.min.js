"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(){window.log=function(e){console.log(e)};var e=[],t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"sortFormFields",value:function(e){var t={};for(var i in Object.keys(e)){var n=e[i].property,s=e[i];"0 Or More"===s.cardinality?(t[n]=t[n]||[],t[n].push(s)):t[n]=s}return t}},{key:"getFirstFieldValue",value:function(e,t){return"array"==typeof t[e]?t[e]:t[e][0]}}]),e}();window.GVCarto=function(){function i(e){_classCallCheck(this,i),window.gvc=this,this.mainComponent=e,this.firstSearch=!0,this.$window=$(window),this.buildingSelected="partout",this.$loadingSpinner=$("#gv-spinner"),this.sfClient=new t,this.$gvMap=$(document.getElementById("gv-map")),"127.0.0.1"===window.location.hostname&&window.document.body.classList.add("dev-env"),this.ajaxMultiple({buildings:"/webservice/building"},this.start)}return _createClass(i,[{key:"ajaxMultiple",value:function(e,t){var i=0,n={},s=this;for(var r in e)i++,$.ajax({url:e[r],complete:function(e){return function(r){i--,n[e]=JSON.parse(r.responseText),0===i&&t.call(s,n)}}(r)})}},{key:"start",value:function(t){var i=this;this.buildings=t.buildings;for(var n in this.buildings)this.buildings[n].key=n;this.domSearchTextInput=this.domId("searchText"),this.domSearchResults=this.domId("searchResults"),this.stateSet("waiting");var s=this.searchEvent.bind(this);this.listen("searchForm","submit",function(e){i.domSearchTextInput.blur(),i.scrollToSearchResults(),s(e)}),this.isReady=!0;var r;this.listen("searchText","keyup",function(){r&&window.clearTimeout(r),r=window.setTimeout(s,500)});for(var a in e)e[a]()}},{key:"stateSet",value:function(e){if(this.stateCurrent!==e){var t=e.charAt(0).toUpperCase()+e.slice(1);if(this.stateCurrent){var i=this.stateCurrent.charAt(0).toUpperCase()+this.stateCurrent.slice(1);this["state"+i+"Exit"](),this.stateCurrent=null}this["state"+t+"Init"]()!==!1&&(this.stateCurrent=e)}}},{key:"loadingPageContentStart",value:function(){this.$loadingSpinner.show()}},{key:"loadingPageContentStop",value:function(){this.$loadingSpinner.hide()}},{key:"stateWaitingInit",value:function(){gvmap.mapShowBuildingPinAll()}},{key:"stateWaitingExit",value:function(){}},{key:"stateSearchInit",value:function(){if(!this.domSearchTextInput.value)return this.stateSet("waiting"),!1}},{key:"stateSearchExit",value:function(){}},{key:"scrollToSearchResults",value:function(e){this.$window.scrollTo($("#searchTabs").offset().top-150,{duration:1e3,easing:"easeOutQuad",complete:e})}},{key:"searchEvent",value:function(e){e&&e.preventDefault();var t=this.domSearchTextInput.value;this.search(t,this.buildingSelected)}},{key:"searchRouteChange",value:function(e,t){this.firstSearch&&(this.domSearchTextInput.value=e,this.buildingSelected="building",this.firstSearch=!1),this.search(e,t)}},{key:"textRemove",value:function(e,t){return e.replace(new RegExp(t,"g"),"")}},{key:"search",value:function(e,t){var i=this;if(this.stateSet("search"),e=e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),this.lastSearchTerm!==e||this.lastSearchBuilding!==t){this.lastSearchTerm=e,this.lastSearchBuilding=t,this.mainComponent.set("route.path","/rechercher/"+(t||"partout")+"/"+e),this.domId("searchResults"),this.domSearchResults.innerHTML="",$("#gv-results-empty, #gv-results-error").hide(),this.loadingPageContentStart();var n=function(e){i.loadingPageContentStop(),i.renderSearchResult(e.responseJSON)};this.searchQueryLastComplete=n,this.loadingPageContentStart(),$.ajax({url:"/webservice/search?b="+encodeURIComponent(t)+"&t="+encodeURIComponent(e),dataType:"json",complete:function(e){n===i.searchQueryLastComplete&&n(e)}})}}},{key:"renderSearchResult",value:function(e){if(e=e||this.renderSearchResultResponse||{},this.renderSearchResultResponse=e,e.error)$("#gv-results-error").show();else if(e.results&&e.results.length){gvmap.mapShowBuildingPin(this.buildingSelected);for(var t in e.results){var i=e.results[t],n=document.createElement("gv-results-item");n.label=i.label,n.uri=i.uri,this.domSearchResults.appendChild(n)}}else $("#gv-results-empty").show()}},{key:"listen",value:function(e,t,i){if(!Array.isArray(t))return this.domId(e).addEventListener(t,i);for(var n in t)this.listen(e,t[n],i)}},{key:"domId",value:function(e){return document.getElementById(e)}},{key:"dom",value:function(e){return document.querySelectorAll(e)}}]),i}(),window.GVCarto.ready=function(t){window.gvc&&window.gvc.isReady?t():e.push(t)}}();
//# sourceMappingURL=main.min.js.map
