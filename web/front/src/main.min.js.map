{"version":3,"sources":["web/front/src/main.js"],"names":["window","log","m","console","debug","readyCallbacks","SFClient","options","_classCallCheck","this","$","extend","formFields","fieldsAliases","http://www.w3.org/1999/02/22-rdf-syntax-ns#type","_createClass","key","value","fields","data","GVCarto","_class","mainComponent","_this","gvc","baseUrl","myRoute","firstSearch","$window","buildingSelectedAll","buildingSelected","sfClient","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#status","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#realisedContribution","http://xmlns.com/foaf/0.1/status","http://xmlns.com/foaf/0.1/name","http://vocab.sindice.net/csv/rowPosition","urn:gv/contactsPrint","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#conventionType","http://virtual-assembly.org/pair_v2#hasResponsible","urn:displayLabel","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#administrativeName","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#building","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#proposedContribution","http://purl.org/dc/elements/1.1/subject","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#arrivalDate","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#room","$gvMap","document","getElementById","searchTypes","http://xmlns.com/foaf/0.1/Person","label","type","plural","http://xmlns.com/foaf/0.1/Organization","http://xmlns.com/foaf/0.1/Project","http://purl.org/NET/c4dm/event.owl#Event","http://www.fipa.org/schemas#Proposition","cookie","get","body","classList","add","set","expires","loadParameters","ajax","response","responseJSON","no_internet","start","path","complete","url","sources","callback","ajaxCounter","allData","self","e","JSON","parse","responseText","call","parameters","buildings","domSearchTextInput","domId","isReady","split","isSearchPage","length","i","goSearch","term","building","location","pathname","results","search","goToPath","scrollTo","offset","top","duration","easing","id","event","Array","isArray","addEventListener","listen","selector","querySelectorAll","params","typeUri","name","access","isSuperAdmin","isAdmin","isMember","element","isAnonymous","haveName","preventDefault","replace","currentTarget","getAttribute","ready","push"],"mappings":"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","file":"main.min.js","sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  // Devel\r\n  window.log = (m) => {\r\n    console.debug(m);\r\n  };\r\n\r\n  var readyCallbacks = [];\r\n\r\n  // A custom client for Semantic Forms specific treatments.\r\n  class SFClient {\r\n    constructor(options) {\r\n      $.extend(true, this, {\r\n        formFields: {},\r\n        fieldsAliases: {\r\n          'http://www.w3.org/1999/02/22-rdf-syntax-ns#type': 'rdfType',\r\n        }\r\n      }, options);\r\n    }\r\n\r\n    getValue(fields, key) {\r\n      key = this.fieldsAliases[key] || key;\r\n      if (fields[key]) {\r\n        let data = typeof fields[key] === 'array' ? fields[key] : fields[key][0];\r\n        return data.value;\r\n      }\r\n      return '';\r\n    }\r\n  }\r\n\r\n  window.GVCarto = class {\r\n\r\n    constructor(mainComponent) {\r\n      window.gvc = this;\r\n      this.baseUrl = '/';\r\n      this.myRoute = 'detail';\r\n      this.mainComponent = mainComponent;\r\n      this.firstSearch = true;\r\n      this.$window = $(window);\r\n      this.buildingSelectedAll = 'partout';\r\n      this.buildingSelected = this.buildingSelectedAll;\r\n      this.sfClient = new SFClient({\r\n        fieldsAliases: {\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#status': 'gvStatus',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#realisedContribution': 'realisedContribution',\r\n          'http://xmlns.com/foaf/0.1/status': 'shortDescription',\r\n          'http://xmlns.com/foaf/0.1/name': 'foafName',\r\n          'http://vocab.sindice.net/csv/rowPosition': 'rowPosition',\r\n          'urn:gv/contactsPrint': 'contactsPrint',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#conventionType': 'conventionType',\r\n          'http://virtual-assembly.org/pair_v2#hasResponsible': 'hasResponsible',\r\n          'urn:displayLabel': 'displayLabel',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#administrativeName': 'administrativeName',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#building': 'building',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#proposedContribution': 'proposedContribution',\r\n          'http://purl.org/dc/elements/1.1/subject': 'subject',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#arrivalDate': 'arrivalDate',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#room': 'room'\r\n        }\r\n      });\r\n      this.$gvMap = $(document.getElementById('gv-map'));\r\n      this.searchTypes = {\r\n        \"http://xmlns.com/foaf/0.1/Person\": {\r\n          label: 'Personne',\r\n          type: 'person',\r\n          plural: 'Personnes'\r\n        },\r\n        \"http://xmlns.com/foaf/0.1/Organization\": {\r\n          label: 'Organisation',\r\n          type: 'organization',\r\n          plural: 'Organisations'\r\n        },\r\n        \"http://xmlns.com/foaf/0.1/Project\": {\r\n          label: 'Projet',\r\n          type: 'projet',\r\n          plural: 'Projets'\r\n        },\r\n        \"http://purl.org/NET/c4dm/event.owl#Event\": {\r\n          label: 'Evénement',\r\n          type: 'event',\r\n          plural: 'Evénements'\r\n        },\r\n        \"http://www.fipa.org/schemas#Proposition\": {\r\n          label: 'Proposition',\r\n          type: 'proposition',\r\n          plural: 'Propositions'\r\n        }\r\n      };\r\n\r\n      // Play intro only once.\r\n      if (cookie.get('introAnimation')) {\r\n        window.document.body.classList.add('skip-intro');\r\n      }\r\n      else {\r\n        cookie.set('introAnimation', true, {\r\n          expires: 1 // Days\r\n        });\r\n      }\r\n\r\n      var loadParameters = () => {\r\n        this.ajax('webservice/parameters', (response) => {\r\n          if (response && response.responseJSON && response.responseJSON.no_internet) {\r\n            // Enter in debug mode.\r\n            this.baseUrl = '/fake_service/';\r\n            // Reload fake parameters.\r\n            loadParameters();\r\n          }\r\n          else {\r\n            this.start(response.responseJSON);\r\n          }\r\n        });\r\n      };\r\n      // Load.\r\n      loadParameters();\r\n    }\r\n\r\n    ajax(path, complete) {\r\n      $.ajax({\r\n        url: this.baseUrl + path,\r\n        complete: complete\r\n      });\r\n    }\r\n\r\n    ajaxMultiple(sources, callback) {\r\n      \"use strict\";\r\n      var ajaxCounter = 0;\r\n      var allData = {};\r\n      var self = this;\r\n      for (var key in sources) {\r\n        ajaxCounter++;\r\n        this.ajax(sources[key], function (key) {\r\n          return function (e) {\r\n            ajaxCounter--;\r\n            allData[key] = JSON.parse(e.responseText);\r\n            // Final callback.\r\n            if (ajaxCounter === 0) {\r\n              callback.call(self, allData);\r\n            }\r\n          }\r\n        }(key));\r\n      }\r\n    }\r\n\r\n    start(parameters) {\r\n      \"use strict\";\r\n      $.extend(this, parameters);\r\n      // Save key for further usage.\r\n      for (let key in this.buildings) {\r\n        this.buildings[key].key = key;\r\n      }\r\n      // Shortcuts.\r\n      this.domSearchTextInput = this.domId('searchText');\r\n\r\n      // Launch callbacks\r\n      this.isReady = true;\r\n\r\n      let split = this.mainComponent.get('route.path').split('/');\r\n      let isSearchPage = split.length >= 2 && (split[1] === 'rechercher' || split[1] === '');\r\n      // We started on a search page.\r\n      if (isSearchPage && split[3]) {\r\n        this.domSearchTextInput.value = split[3];\r\n      }\r\n\r\n      // Ready callbacks.\r\n      for (let i in readyCallbacks) {\r\n        readyCallbacks[i]();\r\n      }\r\n\r\n      // We started on the arrival page or on the search page.\r\n      isSearchPage && this.goSearch();\r\n    }\r\n\r\n    goSearch() {\r\n      let term = this.domSearchTextInput.value;\r\n      let building = this.buildingSelected || 'partout';\r\n      let path = '/rechercher/' + building + '/' + term;\r\n      if (document.location.pathname === path) {\r\n        // Reload search manually.\r\n        this.results.search(term, building);\r\n      }\r\n      else {\r\n        // Changing path will execute search action.\r\n        this.goToPath(path);\r\n      }\r\n    }\r\n\r\n    scrollToContent(complete) {\r\n      this.$window.scrollTo($('#pageContent').offset().top - 150, {\r\n        duration: 1000,\r\n        easing: 'easeOutQuad',\r\n        complete: complete\r\n      });\r\n    }\r\n\r\n    listen(id, event, callback) {\r\n      // Support list of events names.\r\n      if (Array.isArray(event)) {\r\n        for (let i in event) {\r\n          this.listen(id, event[i], callback);\r\n        }\r\n        return;\r\n      }\r\n      return this.domId(id).addEventListener(event, callback);\r\n    }\r\n\r\n    domId(id) {\r\n      return document.getElementById(id);\r\n    }\r\n\r\n    dom(selector) {\r\n      return document.querySelectorAll(selector);\r\n    }\r\n\r\n    goToPath(path, params) {\r\n      this.myRoute = path;\r\n      // Set first params.\r\n      gvc.mainComponent.set('queryParams', params);\r\n      // Changing route fires an event.\r\n      gvc.mainComponent.set('route.path', path);\r\n    }\r\n\r\n    imageOrFallback(path, typeUri) {\r\n      \"use strict\";\r\n      if (!path) {\r\n        return '/common/images/result-no_picture-' + gvc.searchTypes[typeUri].type + '.png';\r\n      }\r\n      return path;\r\n    }\r\n    haveName(){\r\n      return this.name !== '';\r\n    }\r\n    isSuperAdmin() {\r\n      return this.access === 'super_admin';\r\n    }\r\n\r\n    isAdmin() {\r\n      return (this.access === 'admin') || this.isSuperAdmin();\r\n    }\r\n\r\n    isMember() {\r\n      return (this.access === 'super_admin') || this.isAdmin();\r\n    }\r\n\r\n    isAnonymous() {\r\n      return !this.isMember();\r\n    }\r\n\r\n    /**\r\n     * Set parameters from global object,\r\n     * which are user into template as dynamic variables.\r\n     */\r\n    initElementGlobals(element) {\r\n      $.extend(element, {\r\n        isAnonymous: this.isAnonymous(),\r\n        isMember: this.isMember(),\r\n        isAdmin: this.isAdmin(),\r\n        isSuperAdmin: this.isSuperAdmin(),\r\n        haveName: this.haveName()\r\n      });\r\n    }\r\n\r\n    realLink(e) {\r\n      e.preventDefault();\r\n      // Force links to reload the hole page.\r\n      window.location.replace(e.currentTarget.getAttribute('href'));\r\n    }\r\n  };\r\n\r\n  window.GVCarto.ready = function (callback) {\r\n    if (!window.gvc || !window.gvc.isReady) {\r\n      readyCallbacks.push(callback);\r\n    }\r\n    else {\r\n      callback();\r\n    }\r\n  };\r\n}());\r\n"]}