{"version":3,"sources":["web/front/src/main.js"],"names":["window","log","m","console","debug","readyCallbacks","SemAppsCarto","_class","mainComponent","_this","this","_classCallCheck","semapps","baseUrl","myRoute","location","pathname","replace","firstSearch","$window","$","buildingSelectedAll","buildingSelected","$gvMap","document","getElementById","detailAddress","allowedType","loadParameters","ajax","response","responseJSON","no_internet","start","_createClass","key","value","path","complete","url","sources","callback","ajaxCounter","allData","self","e","JSON","parse","responseText","call","parameters","extend","buildings","domSearchTextInput","domId","isReady","split","get","isSearchPage","length","i","goSearch","term","building","results","search","goToPath","scrollTo","offset","top","duration","easing","id","event","Array","isArray","addEventListener","listen","selector","querySelectorAll","params","set","typeUri","entities","nameType","name","access","isSuperAdmin","isAdmin","isMember","string","lower","toLowerCase","a","toUpperCase","element","isAnonymous","haveName","preventDefault","currentTarget","getAttribute","address","title","type","data","success","donnee","map","addPin","features","geometry","coordinates","ready","push"],"mappings":"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","file":"main.min.js","sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  // Devel\r\n  window.log = (m) => {\r\n    console.debug(m);\r\n  };\r\n\r\n  var readyCallbacks = [];\r\n\r\n\r\n  window.SemAppsCarto = class {\r\n\r\n    constructor(mainComponent) {\r\n      log(mainComponent);\r\n      window.semapps = this;\r\n      this.baseUrl = '/';\r\n      this.myRoute = window.location.pathname.replace(/\\//g, '');\r\n      this.mainComponent = mainComponent;\r\n      this.firstSearch = true;\r\n      this.$window = $(window);\r\n      this.buildingSelectedAll = 'partout';\r\n      this.buildingSelected = this.buildingSelectedAll;\r\n      this.$gvMap = $(document.getElementById('semapps-map'));\r\n      this.detailAddress= [];\r\n      this.allowedType = [\r\n          \"http://virtual-assembly.org/pair#Person\",\r\n          \"http://virtual-assembly.org/pair#Organization\",\r\n          \"http://virtual-assembly.org/pair#Project\",\r\n          \"http://virtual-assembly.org/pair#Event\",\r\n          \"http://virtual-assembly.org/pair#Proposal\",\r\n          \"http://virtual-assembly.org/pair#Document\",\r\n          \"http://virtual-assembly.org/pair#DocumentType\",\r\n      ];\r\n\r\n      // Play intro only once.\r\n      // if (cookie.get('introAnimation')) {\r\n      //   window.document.body.classList.add('skip-intro');\r\n      // }\r\n      // else {\r\n      //   cookie.set('introAnimation', true, {\r\n      //     expires: 1 // Days\r\n      //   });\r\n      // }\r\n\r\n      var loadParameters = () => {\r\n        this.ajax('webservice/parameters', (response) => {\r\n          if (response && response.responseJSON && response.responseJSON.no_internet) {\r\n            // Enter in debug mode.\r\n            this.baseUrl = '/fake_service/';\r\n            // Reload fake parameters.\r\n            loadParameters();\r\n          }\r\n          else {\r\n            this.start(response.responseJSON);\r\n          }\r\n        });\r\n      };\r\n      // Load.\r\n      loadParameters();\r\n    }\r\n\r\n    ajax(path, complete) {\r\n      $.ajax({\r\n        url: this.baseUrl + path,\r\n        complete: complete\r\n      });\r\n    }\r\n\r\n    ajaxMultiple(sources, callback) {\r\n      \"use strict\";\r\n      var ajaxCounter = 0;\r\n      var allData = {};\r\n      var self = this;\r\n      for (var key in sources) {\r\n        ajaxCounter++;\r\n        this.ajax(sources[key], function (key) {\r\n          return function (e) {\r\n            ajaxCounter--;\r\n            allData[key] = JSON.parse(e.responseText);\r\n            // Final callback.\r\n            if (ajaxCounter === 0) {\r\n              callback.call(self, allData);\r\n            }\r\n          }\r\n        }(key));\r\n      }\r\n    }\r\n\r\n    start(parameters) {\r\n      \"use strict\";\r\n      $.extend(this, parameters);\r\n      // Save key for further usage.\r\n      for (let key in this.buildings) {\r\n        this.buildings[key].key = key;\r\n      }\r\n      // Shortcuts.\r\n      this.domSearchTextInput = this.domId('searchText');\r\n\r\n      // Launch callbacks\r\n      this.isReady = true;\r\n\r\n      let split = this.mainComponent.get('route.path').split('/');\r\n      let isSearchPage = split.length >= 2 && (split[1] === 'rechercher' || split[1] === '');\r\n      // We started on a search page.\r\n      if (isSearchPage && split[3]) {\r\n        this.domSearchTextInput.value = split[3];\r\n      }\r\n\r\n      // Ready callbacks.\r\n      for (let i in readyCallbacks) {\r\n        readyCallbacks[i]();\r\n      }\r\n\r\n      // We started on the arrival page or on the search page.\r\n      isSearchPage && this.goSearch();\r\n    }\r\n\r\n    goSearch() {\r\n      let term = this.domSearchTextInput.value;\r\n      let building = this.buildingSelected.split('/')[this.buildingSelected.split('/').length-1] || 'partout';\r\n      let path = '/rechercher/' + building ;//+ '/' + term;\r\n      path += (term)? '/' + term : '';\r\n      if (document.location.pathname === path) {\r\n        // Reload search manually.\r\n        this.results.search(term, building);\r\n      }\r\n      else {\r\n        // Changing path will execute search action.\r\n        this.goToPath(path);\r\n      }\r\n    }\r\n\r\n    scrollToContent(complete) {\r\n      this.$window.scrollTo($('#pageContent').offset().top - 150, {\r\n        duration: 1000,\r\n        easing: 'easeOutQuad',\r\n        complete: complete\r\n      });\r\n    }\r\n\r\n    listen(id, event, callback) {\r\n      // Support list of events names.\r\n      if (Array.isArray(event)) {\r\n        for (let i in event) {\r\n          this.listen(id, event[i], callback);\r\n        }\r\n        return;\r\n      }\r\n      return this.domId(id).addEventListener(event, callback);\r\n    }\r\n\r\n    domId(id) {\r\n      return document.getElementById(id);\r\n    }\r\n\r\n    dom(selector) {\r\n      return document.querySelectorAll(selector);\r\n    }\r\n\r\n    goToPath(path, params) {\r\n      this.myRoute = path;\r\n      // Set first params.\r\n      semapps.mainComponent.set('queryParams', params);\r\n      // Changing route fires an event.\r\n      semapps.mainComponent.set('route.path', path);\r\n    }\r\n\r\n    imageOrFallback(path, typeUri) {\r\n      \"use strict\";\r\n      if (!path) {\r\n        return '/common/images/result-no_picture-' + semapps.entities[typeUri].nameType + '.png';\r\n      }\r\n      return path;\r\n    }\r\n    haveName(){\r\n      return this.name !== '';\r\n    }\r\n    isSuperAdmin() {\r\n      return this.access === 'super_admin';\r\n    }\r\n\r\n    isAdmin() {\r\n      return (this.access === 'admin') || this.isSuperAdmin();\r\n    }\r\n\r\n    isMember() {\r\n      return (this.access === 'super_admin') || this.isAdmin();\r\n    }\r\n\r\n    isAnonymous() {\r\n      return !this.isMember();\r\n    }\r\n\r\n    capitalize(string,lower) {\r\n        return (lower ? string.toLowerCase() : string).replace(/(?:^|\\s)\\S/g, function(a) { return a.toUpperCase(); });\r\n    };\r\n    /**\r\n     * Set parameters from global object,\r\n     * which are user into template as dynamic variables.\r\n     */\r\n    initElementGlobals(element) {\r\n      $.extend(element, {\r\n        isAnonymous: this.isAnonymous(),\r\n        isMember: this.isMember(),\r\n        isAdmin: this.isAdmin(),\r\n        isSuperAdmin: this.isSuperAdmin(),\r\n        haveName: this.haveName()\r\n      });\r\n    }\r\n\r\n    realLink(e) {\r\n      e.preventDefault();\r\n      // Force links to reload the hole page.\r\n      window.location.replace(e.currentTarget.getAttribute('href'));\r\n    }\r\n\r\n    getAddressToCreatePoint(address,title,type){\r\n        $.ajax({\r\n            url : 'http://api-adresse.data.gouv.fr/search/', // on appelle le script JSON\r\n            data: 'q=' + address,\r\n            success : function(donnee){\r\n                semapps.map.addPin(donnee.features[0].geometry.coordinates[1],donnee.features[0].geometry.coordinates[0], address,title,type);\r\n                semapps.detailAddress[address] = donnee;\r\n            },\r\n        });\r\n    }\r\n  };\r\n\r\n  window.SemAppsCarto.ready = function (callback) {\r\n    if (!window.semapps || !window.semapps.isReady) {\r\n      readyCallbacks.push(callback);\r\n    }\r\n    else {\r\n      callback();\r\n    }\r\n  };\r\n}());\r\n"]}