{"version":3,"sources":["web/front/src/main.js"],"names":["window","log","m","console","readyCallbacks","SFClient","options","_classCallCheck","this","$","extend","formFields","fieldsAliases","http://www.w3.org/1999/02/22-rdf-syntax-ns#type","_createClass","key","value","fields","data","GVCarto","_class","mainComponent","gvc","firstSearch","$window","buildingSelectedAll","buildingSelected","sfClient","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#status","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#realisedContribution","http://xmlns.com/foaf/0.1/status","http://xmlns.com/foaf/0.1/name","http://vocab.sindice.net/csv/rowPosition","urn:gv/contactsPrint","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#conventionType","http://virtual-assembly.org/pair_v2#hasResponsible","urn:displayLabel","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#administrativeName","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#building","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#proposedContribution","http://purl.org/dc/elements/1.1/subject","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#arrivalDate","http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#room","$gvMap","document","getElementById","searchTypes","http://xmlns.com/foaf/0.1/Person","label","type","http://xmlns.com/foaf/0.1/Organization","location","hostname","body","classList","add","ajaxMultiple","parameters","start","sources","callback","ajaxCounter","allData","self","ajax","url","complete","e","JSON","parse","responseText","call","buildings","entities","domSearchTextInput","domId","stateSet","isReady","i","stateName","stateCurrent","nameCapitalized","charAt","toUpperCase","slice","nameCurrentCapitalized","term","set","scrollTo","offset","top","duration","easing","id","event","Array","isArray","addEventListener","listen","selector","querySelectorAll","path","params","ready","push"],"mappings":"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","file":"main.min.js","sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  // Devel\r\n  window.log = (m) => {\r\n    console.log(m);\r\n  };\r\n\r\n  var readyCallbacks = [];\r\n\r\n  // A custom client for Semantic Forms specific treatments.\r\n  class SFClient {\r\n    constructor(options) {\r\n      $.extend(true, this, {\r\n        formFields: {},\r\n        fieldsAliases: {\r\n          'http://www.w3.org/1999/02/22-rdf-syntax-ns#type': 'rdfType',\r\n        }\r\n      }, options);\r\n    }\r\n\r\n    getValue(fields, key) {\r\n      key = this.fieldsAliases[key] || key;\r\n      if (fields[key]) {\r\n        let data = typeof fields[key] === 'array' ? fields[key] : fields[key][0];\r\n        return data.value;\r\n      }\r\n      return '';\r\n    }\r\n  }\r\n\r\n  window.GVCarto = class {\r\n\r\n    constructor(mainComponent) {\r\n      window.gvc = this;\r\n      this.mainComponent = mainComponent;\r\n      this.firstSearch = true;\r\n      this.$window = $(window);\r\n      this.buildingSelectedAll = 'partout';\r\n      this.buildingSelected = this.buildingSelectedAll;\r\n      this.sfClient = new SFClient({\r\n        fieldsAliases: {\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#status': 'gvStatus',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#realisedContribution': 'realisedContribution',\r\n          'http://xmlns.com/foaf/0.1/status': 'foafStatus',\r\n          'http://xmlns.com/foaf/0.1/name': 'foafName',\r\n          'http://vocab.sindice.net/csv/rowPosition': 'rowPosition',\r\n          'urn:gv/contactsPrint': 'contactsPrint',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#conventionType': 'conventionType',\r\n          'http://virtual-assembly.org/pair_v2#hasResponsible': 'hasResponsible',\r\n          'urn:displayLabel': 'displayLabel',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#administrativeName': 'administrativeName',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#building': 'building',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#proposedContribution': 'proposedContribution',\r\n          'http://purl.org/dc/elements/1.1/subject': 'subject',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#arrivalDate': 'arrivalDate',\r\n          'http://assemblee-virtuelle.github.io/grands-voisins-v2/gv.owl.ttl#room': 'room'\r\n        }\r\n      });\r\n      this.$gvMap = $(document.getElementById('gv-map'));\r\n      this.searchTypes = {\r\n        \"http://xmlns.com/foaf/0.1/Person\": {\r\n          label: 'Personne',\r\n          type: 'person'\r\n        },\r\n        \"http://xmlns.com/foaf/0.1/Organization\": {\r\n          label: 'Organisation',\r\n          type: 'organization'\r\n        }\r\n      };\r\n\r\n      // Special class for dev env.\r\n      if (window.location.hostname === '127.0.0.1') {\r\n        window.document.body.classList.add('dev-env');\r\n      }\r\n\r\n      this.ajaxMultiple({\r\n        parameters: '/webservice/parameters'\r\n      }, this.start);\r\n    }\r\n\r\n    ajaxMultiple(sources, callback) {\r\n      \"use strict\";\r\n      var ajaxCounter = 0;\r\n      var allData = {};\r\n      var self = this;\r\n      for (var key in sources) {\r\n        ajaxCounter++;\r\n        $.ajax({\r\n          url: sources[key],\r\n          complete: function (key) {\r\n            return function (e) {\r\n              ajaxCounter--;\r\n              allData[key] = JSON.parse(e.responseText);\r\n              // Final callback.\r\n              if (ajaxCounter === 0) {\r\n                callback.call(self, allData);\r\n              }\r\n            }\r\n          }(key)\r\n        });\r\n      }\r\n    }\r\n\r\n    start(data) {\r\n      \"use strict\";\r\n      this.buildings = data.parameters.buildings;\r\n      this.entities = data.parameters.entities;\r\n      // Save key for further usage.\r\n      for (let key in this.buildings) {\r\n        this.buildings[key].key = key;\r\n      }\r\n      // Shortcuts.\r\n      this.domSearchTextInput = this.domId('searchText');\r\n      this.stateSet('waiting');\r\n\r\n      // TODO ? this.setSearchType(this.searchTypeCurrent);\r\n\r\n      // Launch callbacks\r\n      this.isReady = true;\r\n\r\n      // Ready callbacks.\r\n      for (let i in readyCallbacks) {\r\n        readyCallbacks[i]();\r\n      }\r\n    }\r\n\r\n    stateSet(stateName) {\r\n      if (this.stateCurrent !== stateName) {\r\n        let nameCapitalized = stateName.charAt(0).toUpperCase() + stateName.slice(1);\r\n        if (this.stateCurrent) {\r\n          let nameCurrentCapitalized = this.stateCurrent.charAt(0).toUpperCase() + this.stateCurrent.slice(1);\r\n          this['state' + nameCurrentCapitalized + 'Exit']();\r\n          this.stateCurrent = null;\r\n        }\r\n        // Callback should not return false if success.\r\n        if (this['state' + nameCapitalized + 'Init']() !== false) {\r\n          this.stateCurrent = stateName;\r\n        }\r\n      }\r\n    }\r\n\r\n    /*setSearchType(type) {\r\n\r\n\r\n     // Reload render results.\r\n     gvc.renderSearchResult();\r\n     }*/\r\n\r\n    /*loadingPageContentStart() {\r\n     this.$loadingSpinner.show();\r\n     }\r\n\r\n     loadingPageContentStop() {\r\n     this.$loadingSpinner.hide();\r\n     }*/\r\n\r\n    /* -- Waiting --*/\r\n    stateWaitingInit() {\r\n      //gvc.map.mapShowBuildingPinAll();\r\n    }\r\n\r\n    stateWaitingExit() {\r\n      //gvc.map.mapHideBuildingPinAll();\r\n    }\r\n\r\n    /* -- Search -- */\r\n\r\n    /*stateSearchInit() {\r\n     if (!this.domSearchTextInput.value) {\r\n     this.stateSet('waiting');\r\n     // Block saving current state.\r\n     return false;\r\n     }\r\n     }\r\n\r\n     stateSearchExit() {\r\n\r\n     }*/\r\n\r\n    goSearch() {\r\n      var term = this.domSearchTextInput.value;\r\n      this.mainComponent.set('route.path', '/rechercher/' + (this.buildingSelected || 'partout') + '/' + term);\r\n    }\r\n\r\n    scrollToSearchResults(complete) {\r\n      this.$window.scrollTo($('#searchTabs').offset().top - 150, {\r\n        duration: 1000,\r\n        easing: 'easeOutQuad',\r\n        complete: complete\r\n      });\r\n    }\r\n\r\n    /*\r\n     searchRouteChange(term, building) {\r\n     if (this.firstSearch) {\r\n     // Set value to input (used at first page load)\r\n     this.domSearchTextInput.value = term;\r\n     this.firstSearch = false;\r\n     }\r\n\r\n     // There is no building with this name.\r\n     if (!this.buildings[building]) {\r\n     building = this.buildingSelectedAll;\r\n     }\r\n\r\n     // Launch search.\r\n     this.search(term, building);\r\n     }\r\n\r\n     textRemove(term, char) {\r\n     return term.replace(new RegExp(char, 'g'), '');\r\n     }\r\n\r\n     search(term, building) {\r\n     this.stateSet('search');\r\n     log(' SEARCH ');\r\n\r\n\r\n     // Prevent recursions due to route event changes,\r\n     // and also prevent to search two times the same values.\r\n     if (this.lastSearchTerm === term && this.lastSearchBuilding === building) {\r\n     return;\r\n     }\r\n\r\n     this.lastSearchTerm = term;\r\n     this.lastSearchBuilding = building;\r\n\r\n\r\n\r\n\r\n\r\n     // Hide counters.\r\n     this.$tabs.find('li .counter').hide();\r\n\r\n     // Hide all results.\r\n     $('#gv-results-empty, #gv-results-error').hide();\r\n     this.loadingPageContentStart();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n     }\r\n\r\n     renderSearchResult(response) {\r\n     \"use strict\";\r\n\r\n\r\n     gvc.map && gvc.map.mapHideBuildingPinAll();\r\n\r\n\r\n     window.gvresults && window.gvresults.selectType(this.searchTypeCurrent);\r\n\r\n\r\n     }*/\r\n\r\n    listen(id, event, callback) {\r\n      // Support list of events names.\r\n      if (Array.isArray(event)) {\r\n        for (let i in event) {\r\n          this.listen(id, event[i], callback);\r\n        }\r\n        return;\r\n      }\r\n      return this.domId(id).addEventListener(event, callback);\r\n    }\r\n\r\n    domId(id) {\r\n      return document.getElementById(id);\r\n    }\r\n\r\n    dom(selector) {\r\n      return document.querySelectorAll(selector);\r\n    }\r\n\r\n    goToPath(path, params) {\r\n      // Set first params.\r\n      gvc.mainComponent.set('queryParams', params);\r\n      // Changing route fires an event.\r\n      gvc.mainComponent.set('route.path', path);\r\n    }\r\n  };\r\n\r\n  window.GVCarto.ready = function (callback) {\r\n    if (!window.gvc || !window.gvc.isReady) {\r\n      readyCallbacks.push(callback);\r\n    }\r\n    else {\r\n      callback();\r\n    }\r\n  };\r\n}());\r\n"]}