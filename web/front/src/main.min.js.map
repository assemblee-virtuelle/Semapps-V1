{"version":3,"sources":["web/front/src/main.js"],"names":["window","log","m","console","debug","readyCallbacks","SemAppsCarto","_class","mainComponent","_this","this","_classCallCheck","semapps","baseUrl","myRoute","location","pathname","replace","firstSearch","$window","$","buildingSelectedAll","buildingSelected","$gvMap","document","getElementById","detailAddress","allowedType","loadParameters","ajax","response","responseJSON","no_internet","start","_createClass","key","value","path","complete","url","sources","callback","ajaxCounter","allData","self","e","JSON","parse","responseText","call","parameters","extend","userUri","userGraphUri","domSearchTextInput","domId","isReady","split","get","isSearchPage","length","i","goSearch","term","building","results","search","goToPath","scrollTo","offset","top","duration","easing","id","event","Array","isArray","addEventListener","listen","selector","querySelectorAll","params","set","typeUri","entities","nameType","name","access","isSuperAdmin","isAdmin","isMember","string","lower","toLowerCase","a","toUpperCase","element","isAnonymous","haveName","preventDefault","currentTarget","getAttribute","address","title","type","uri","data","success","donnee","map","addPin","features","geometry","coordinates","ready","push"],"mappings":"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","file":"main.min.js","sourcesContent":["(function () {\n  'use strict';\n\n  // Devel\n  window.log = (m) => {\n    console.debug(m);\n  };\n\n  var readyCallbacks = [];\n\n\n  window.SemAppsCarto = class {\n\n    constructor(mainComponent) {\n      log(mainComponent);\n      window.semapps = this;\n      this.baseUrl = '/';\n      this.myRoute = window.location.pathname.replace(/\\//g, '');\n      this.mainComponent = mainComponent;\n      this.firstSearch = true;\n      this.$window = $(window);\n      this.buildingSelectedAll = 'partout';\n      this.buildingSelected = this.buildingSelectedAll;\n      this.$gvMap = $(document.getElementById('semapps-map'));\n      this.detailAddress= [];\n      this.allowedType = [\n          \"http://virtual-assembly.org/pair#Person\",\n          \"http://virtual-assembly.org/pair#Organization\",\n          \"http://virtual-assembly.org/pair#Project\",\n          \"http://virtual-assembly.org/pair#Event\",\n          \"http://virtual-assembly.org/pair#Proposal\",\n          \"http://virtual-assembly.org/pair#Document\",\n          \"http://virtual-assembly.org/pair#DocumentType\",\n      ];\n\n      var loadParameters = () => {\n        this.ajax('webservice/parameters', (response) => {\n          if (response && response.responseJSON && response.responseJSON.no_internet) {\n            // Enter in debug mode.\n            this.baseUrl = '/fake_service/';\n            // Reload fake parameters.\n            loadParameters();\n          }\n          else {\n            this.start(response.responseJSON);\n          }\n        });\n      };\n      // Load.\n      loadParameters();\n    }\n\n    ajax(path, complete) {\n      $.ajax({\n        url: this.baseUrl + path,\n        complete: complete\n      });\n    }\n\n    ajaxMultiple(sources, callback) {\n      \"use strict\";\n      var ajaxCounter = 0;\n      var allData = {};\n      var self = this;\n      for (var key in sources) {\n        ajaxCounter++;\n        this.ajax(sources[key], function (key) {\n          return function (e) {\n            ajaxCounter--;\n            allData[key] = JSON.parse(e.responseText);\n            // Final callback.\n            if (ajaxCounter === 0) {\n              callback.call(self, allData);\n            }\n          }\n        }(key));\n      }\n    }\n\n    start(parameters) {\n      \"use strict\";\n      $.extend(this, parameters);\n      log(this.userUri);\n      log(this.userGraphUri);\n      // Shortcuts.\n      this.domSearchTextInput = this.domId('searchText');\n\n      // Launch callbacks\n      this.isReady = true;\n\n      let split = this.mainComponent.get('route.path').split('/');\n      let isSearchPage = split.length >= 2 && (split[1] === 'rechercher' || split[1] === '');\n      // We started on a search page.\n      if (isSearchPage && split[3]) {\n        this.domSearchTextInput.value = split[3];\n      }\n\n      // Ready callbacks.\n      for (let i in readyCallbacks) {\n        readyCallbacks[i]();\n      }\n\n      // We started on the arrival page or on the search page.\n      isSearchPage && this.goSearch();\n    }\n\n    goSearch() {\n      let term = this.domSearchTextInput.value;\n      let building = this.buildingSelected.split('/')[this.buildingSelected.split('/').length-1] || 'partout';\n      let path = '/rechercher/' + building ;//+ '/' + term;\n      path += (term)? '/' + term : '';\n      if (document.location.pathname === path) {\n        // Reload search manually.\n        this.results.search(term, building);\n      }\n      else {\n        // Changing path will execute search action.\n        this.goToPath(path);\n      }\n    }\n\n    scrollToContent(complete) {\n      this.$window.scrollTo($('#pageContent').offset().top - 150, {\n        duration: 1000,\n        easing: 'easeOutQuad',\n        complete: complete\n      });\n    }\n\n    listen(id, event, callback) {\n      // Support list of events names.\n      if (Array.isArray(event)) {\n        for (let i in event) {\n          this.listen(id, event[i], callback);\n        }\n        return;\n      }\n      return this.domId(id).addEventListener(event, callback);\n    }\n\n    domId(id) {\n      return document.getElementById(id);\n    }\n\n    dom(selector) {\n      return document.querySelectorAll(selector);\n    }\n\n    goToPath(path, params) {\n      this.myRoute = path;\n      // Set first params.\n      semapps.mainComponent.set('queryParams', params);\n      // Changing route fires an event.\n      semapps.mainComponent.set('route.path', path);\n    }\n\n    imageOrFallback(path, typeUri) {\n      \"use strict\";\n      if (!path) {\n        return '/common/images/result-no_picture-' + semapps.entities[typeUri].nameType + '.png';\n      }\n      return path;\n    }\n    haveName(){\n      return this.name !== '';\n    }\n    isSuperAdmin() {\n      return this.access === 'super_admin';\n    }\n\n    isAdmin() {\n      return (this.access === 'admin') || this.isSuperAdmin();\n    }\n\n    isMember() {\n      return (this.access === 'super_admin') || this.isAdmin();\n    }\n\n    isAnonymous() {\n      return !this.isMember();\n    }\n\n    capitalize(string,lower) {\n        return (lower ? string.toLowerCase() : string).replace(/(?:^|\\s)\\S/g, function(a) { return a.toUpperCase(); });\n    };\n    /**\n     * Set parameters from global object,\n     * which are user into template as dynamic variables.\n     */\n    initElementGlobals(element) {\n      $.extend(element, {\n        isAnonymous: this.isAnonymous(),\n        isMember: this.isMember(),\n        isAdmin: this.isAdmin(),\n        isSuperAdmin: this.isSuperAdmin(),\n        haveName: this.haveName()\n      });\n    }\n\n    realLink(e) {\n      e.preventDefault();\n      // Force links to reload the hole page.\n      window.location.replace(e.currentTarget.getAttribute('href'));\n    }\n\n    getAddressToCreatePoint(address,title,type,uri){\n        $.ajax({\n            url : 'http://api-adresse.data.gouv.fr/search/', // on appelle le script JSON\n            data: 'q=' + address,\n            success : function(donnee){\n                semapps.map.addPin(donnee.features[0].geometry.coordinates[1],donnee.features[0].geometry.coordinates[0], uri,title,type);\n                semapps.detailAddress[address] = donnee;\n            },\n        });\n    }\n  };\n\n  window.SemAppsCarto.ready = function (callback) {\n    if (!window.semapps || !window.semapps.isReady) {\n      readyCallbacks.push(callback);\n    }\n    else {\n      callback();\n    }\n  };\n}());\n"]}