"use strict";Polymer({is:"gv-results",properties:{tabFirst:{type:Object,value:{type:"all",plural:"Tous",icon:"list"}},typeSelected:{type:String},tabs:{type:Array,value:[]},tabsRegistry:{type:Object,value:{}},results:{type:Array,value:[]},searchPreviousTerm:{type:String,value:null},searchPreviousBuilding:{type:String,value:null},route:{type:Object,observer:"_routeChanged"}},attached:function(){var e=this;gvc.results=this,this.domSearchResults=gvc.domId("searchResults"),this.domLoadingSpinner=gvc.domId("searchLoadingSpinner"),GVCarto.ready(function(){var t=[e.tabFirst];$.each(gvc.entities,function(e,s){s.counter=0,t.push(s)}),e.tabs=t,e.selectType("all")})},tabRegister:function(e,t){this.tabsRegistry[e]=t,this.selectType(this.typeSelected)},selectType:function(e){this.typeSelected&&this.tabsRegistry[e]&&this.tabsRegistry[this.typeSelected].$$("li").classList.remove("active"),this.typeSelected=e,this.tabsRegistry[e]&&this.tabsRegistry[e].$$("li").classList.add("active"),this.searchRender()},_routeChanged:function(e){var t=this;"/rechercher"===e.prefix&&window.GVCarto.ready(function(){var s=e.path.split("/");gvc.buildingSelected=t.searchPreviousBuilding=gvc.buildings[s[1]]?s[1]:gvc.buildingSelectedAll,t.searchPreviousTerm===s[2]?t.searchRender():(t.searchPreviousTerm=s[2],t.search(s[2],s[1]))})},search:function(e){var t=this;e=(e||"").replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),this.searchError=!1,this.results=[],this.domLoadingSpinner.style.display="block";var s=function(e){t.domLoadingSpinner.style.display="none",t.searchRender(e.responseJSON)};this.searchQueryLastComplete=s,$.ajax({url:"/webservice/search?t="+encodeURIComponent(e),dataType:"json",complete:function(e){s===t.searchQueryLastComplete&&s(e)}})},searchRender:function(e){var t=this,s=[];this.results.length=0,this.set("results",[]);var r=0,i={},a={};if(e=e||this.renderSearchResultResponse||{},this.renderSearchResultResponse=e,e.error)this.searchError=!0;else if(e.results){this.searchError=!1;var l=!0,c=!1,n=void 0;try{for(var u,h=e.results[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var o=u.value;gvc.searchTypes[o.type]&&(i[o.type]=i[o.type]||0,i[o.type]++,r++,gvc.buildings[o.building]&&(a[o.building]=a[o.building]||0,a[o.building]++),"all"!==this.typeSelected&&o.type!==this.typeSelected||gvc.buildingSelected!==gvc.buildingSelectedAll&&o.building!==gvc.buildingSelected||s.push(o))}}catch(e){c=!0,n=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw n}}$.each(gvc.buildings,function(e,t){a[e]||e===gvc.buildingSelected?gvc.map.pinShow(e,a[e]||0):gvc.map.pinHide(e)})}this.tabsRegistry.all&&(this.tabsRegistry.all.counter=r);var d=!0,y=!1,g=void 0;try{for(var p,v=Object.keys(gvc.searchTypes)[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var b=p.value;this.tabsRegistry[b]&&(this.tabsRegistry[b].counter=i[b]||0)}}catch(e){y=!0,g=e}finally{try{!d&&v.return&&v.return()}finally{if(y)throw g}}setTimeout(function(){t.set("results",s)},100)}});
//# sourceMappingURL=gv-results.min.js.map
