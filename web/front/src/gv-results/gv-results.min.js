"use strict";Polymer({is:"gv-results",properties:{tabFirst:{type:Object,value:{type:"all",plural:"Tous",icon:"list"}},typeSelected:{type:String},tabs:{type:Array,value:[]},tabsRegistry:{type:Object,value:{}},results:{type:Array,value:[]},searchLastTerm:{type:String,value:null},route:{type:Object,observer:"_routeChanged"}},attached:function(){var e=this;gvc.results=this,this.domSearchResults=gvc.domId("searchResults"),this.domLoadingSpinner=gvc.domId("searchLoadingSpinner"),this.$searchThemeFilter=$("#searchThemeFilter"),GVCarto.ready(function(){var t=[],s="";$.each(gvc.entities,function(e,i){i.counter=0,s=""==s?e:s,t.push(i)}),e.tabs=t,e.selectType(s)})},tabRegister:function(e,t){this.tabsRegistry[e]=t,this.selectType(this.typeSelected)},selectType:function(e){this.selection(e),this.searchRender()},_routeChanged:function(e){var t=this;"/rechercher"===e.prefix&&window.GVCarto.ready(function(){var s=e.path.split("/");t.search(s[2],s[1])})},search:function(e,t){var s=this,i=this.$searchThemeFilter.val();if(gvc.buildingSelected=gvc.searchLastBuilding=gvc.buildings[t]?t:gvc.buildingSelectedAll,gvc.searchLastTerm===e&&gvc.searchLastFilter===i)return void this.searchRender();gvc.searchLastTerm=e=(e||"").replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),gvc.searchLastFilter=i,this.searchError=this.noResult=!1,this.results=[],this.domLoadingSpinner.style.display="block";var r=function(e){s.domLoadingSpinner.style.display="none",s.searchRender(e.responseJSON)};this.searchQueryLastComplete=r,gvc.ajax("webservice/search?t="+encodeURIComponent(e)+"&f="+encodeURIComponent(gvc.searchLastFilter),function(e){r===s.searchQueryLastComplete&&r(e)})},searchRender:function(e){var t=this,s=[];this.searchError=this.noResult=!1,this.results.length=0,this.set("results",[]);var i=0,r={},l={},c={};if(e=e||this.renderSearchResultResponse||{},this.renderSearchResultResponse=e,e.error)this.searchError=!0;else if(e.results){var a=!0,n=!1,h=void 0;try{for(var o,u=e.results[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var d=o.value;gvc.searchTypes[d.type]&&(gvc.buildings[d.building]&&(l[d.building]=l[d.building]||0,l[d.building]++),gvc.buildingSelected!==gvc.buildingSelectedAll&&d.building!==gvc.buildingSelected||(r[d.type]=r[d.type]||0,r[d.type]++,i++,void 0===c[d.type]&&(c[d.type]=[]),c[d.type].push(d)))}}catch(e){n=!0,h=e}finally{try{!a&&u.return&&u.return()}finally{if(n)throw h}}if(void 0===c[this.typeSelected]){var g=Object.keys(c)[0];this.selection(g),s=void 0!==c[this.typeSelected]?c[Object.keys(c)[0]]:[]}else s=c[this.typeSelected];var v="";v+=s.length?s.length+" résultats dans ":"Aucun résultat dans ",v+=gvc.buildingSelected===gvc.buildingSelectedAll?"tous les bâtiments":"le bâtiment "+gvc.buildings[gvc.buildingSelected].title,this.resultsTitle=v,this.noResult=0===s.length,gvc.map.pinHideAll(),$.each(gvc.buildings,function(e){(l[e]||e===gvc.buildingSelected)&&gvc.map.pinShow(e,l[e]||0)})}this.tabsRegistry.all&&(this.tabsRegistry.all.counter=i);var y=!0,p=!1,b=void 0;try{for(var S,f=Object.keys(gvc.searchTypes)[Symbol.iterator]();!(y=(S=f.next()).done);y=!0){var R=S.value;this.tabsRegistry[R]&&(this.tabsRegistry[R].counter=r[R]||0)}}catch(e){p=!0,b=e}finally{try{!y&&f.return&&f.return()}finally{if(p)throw b}}setTimeout(function(){t.set("results",s)},100)},selection:function(e){this.typeSelected&&this.tabsRegistry[e]&&this.tabsRegistry[this.typeSelected].$$("li").classList.remove("active"),this.typeSelected=e,log(this.typeSelected),this.tabsRegistry[e]&&this.tabsRegistry[e].$$("li").classList.add("active")}});
//# sourceMappingURL=gv-results.min.js.map
