{"version":3,"sources":["web/admin/js/src/class/lgvAdmin.js","web/admin/js/src/class/lgvAdminPage.js","web/admin/js/src/class/lgvAdminPageTeam.js","web/admin/js/src/class/lgvAdminPageProfile.js","web/admin/js/src/class/lgvAdminPageOrga.js","web/admin/js/src/main.js"],"names":["window","log","m","console","LgvAdmin","_this","this","_classCallCheck","$","init","$loadingPageSpin","lgvAdmin","$modalConfirm","$modalConfirmBody","find","$modalConfirmValidate","select2","width","ajax","url","dataType","delay","data","params","QueryString","term","MaxHits","processResults","items","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","results","Symbol","iterator","next","done","result","value","push","id","uri","text","label","err","return","cache","QueryClass","attr","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","LgvAdminPageTeam","LgvAdminPageProfile","LgvAdminPageOrga","message","callback","_this2","html","modal","one","removeClass","addClass","LgvAdminPage","admin","cloneWidget","on","parent","first","name","location","href","replace","regex","RegExp","exec","decodeURIComponent","_get","prototype","__proto__","Object","getPrototypeOf","call","click","e","preventDefault","userId","currentTarget","modalConfirm","document","getElementById","each","$this","change","roles","val","$toggle","toggle","getParameterByName","$form","pageLoadingStart","submit"],"mappings":"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","file":"script.min.js","sourcesContent":["window.log = (m) => {\r\n  \"use strict\";\r\n  console.log(m);\r\n};\r\n\r\nclass LgvAdmin {\r\n  constructor() {\r\n    // Wait document loaded.\r\n    $(()=> {\r\n      this.init();\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.$loadingPageSpin = $('#loadingPageSpin');\r\n    // Save globally.\r\n    window.lgvAdmin = this;\r\n\r\n    // Define reused variables.\r\n    this.$modalConfirm = $('#modalConfirm');\r\n    this.$modalConfirmBody = this.$modalConfirm.find('.modal-body:first');\r\n    this.$modalConfirmValidate = this.$modalConfirm.find('.btn-primary:first');\r\n\r\n    $('.select2-dbPedia').select2({\r\n      width: '100%',\r\n      ajax: {\r\n        url: \"http://lookup.dbpedia.org/api/search.asmx/PrefixSearch\",\r\n        dataType: 'json',\r\n        delay: 250,\r\n        data: function (params) {\r\n          return {\r\n            QueryString: params.term,\r\n            MaxHits: 15\r\n          };\r\n        },\r\n        processResults: function (data, params) {\r\n          let items = [];\r\n          for (let result of data.results) {\r\n            items.push({\r\n              id: result.uri,\r\n              text: result.label\r\n            });\r\n          }\r\n          return {\r\n            results: items\r\n          };\r\n        },\r\n        cache: true\r\n      }\r\n    });\r\n\r\n    $('.select2-lookup').select2({\r\n      ajax: {\r\n        url: \"/webservice/lookup\",\r\n        dataType: 'json',\r\n        delay: 250,\r\n        data: function (params) {\r\n          return {\r\n            QueryString: params.term,\r\n            QueryClass: $(this).attr('data-query-class')\r\n          };\r\n        },\r\n        processResults: function (data, params) {\r\n          let items = [];\r\n          for (let result of data.results) {\r\n            items.push({\r\n              id: result.uri,\r\n              text: result.label\r\n            });\r\n          }\r\n          return {\r\n            results: items\r\n          };\r\n        }\r\n      }\r\n    });\r\n\r\n    new LgvAdminPageTeam(this);\r\n    new LgvAdminPageProfile(this);\r\n    new LgvAdminPageOrga(this);\r\n  }\r\n\r\n  modalConfirm(message, callback) {\r\n    this.$modalConfirmBody.html(message);\r\n    this.$modalConfirm.modal('show');\r\n    this.$modalConfirmValidate.one('click', () => {\r\n      this.$modalConfirm.modal('hide');\r\n      callback();\r\n    });\r\n  }\r\n\r\n  pageLoadingStart() {\r\n    this.$loadingPageSpin\r\n      .removeClass('fadeOut')\r\n      .addClass('fadeIn');\r\n  }\r\n\r\n  pageLoadingStop() {\r\n    this.$loadingPageSpin\r\n      .removeClass('fadeIn')\r\n      .addClass('fadeOut');\r\n  }\r\n}\r\n\r\n","class LgvAdminPage {\r\n  constructor(admin) {\r\n    this.admin = admin;\r\n\r\n    // Need wikipedia.js and formInteraction.js\r\n    if (window.cloneWidget) {\r\n      // Manage widgets duplication.\r\n      $(\".form-group\").on('click', '.add-widget', function () {\r\n        cloneWidget($(this)\r\n          .parent()\r\n          .parent()\r\n          .find('.sf-value-block')\r\n          .first()\r\n          .find('.ref')\r\n          .first())\r\n      });\r\n    }\r\n    this.init();\r\n  }\r\n\r\n  init() {}\r\n\r\n  getParameterByName(name, url) {\r\n    if (!url) {\r\n      url = window.location.href;\r\n    }\r\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\r\n      results = regex.exec(url);\r\n    if (!results) return null;\r\n    if (!results[2]) return '';\r\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\r\n  }\r\n}\r\n","class LgvAdminPageTeam extends LgvAdminPage {\r\n  init() {\r\n    super.init();\r\n\r\n    // On user profile, remove user button.\r\n    $('.team-user-delete').click((e) => {\r\n      // Disable default click behavior.\r\n      e.preventDefault();\r\n      let userId = $(e.currentTarget).attr('rel');\r\n      // Use custom modal for message.\r\n      this.admin.modalConfirm('Êtes-vous sûr de vouloir supprimer ce compte ? ' +\r\n        'Toutes les informations du profil seront perdues, ' +\r\n        'et le membre n\\'aura plus accès au site.', () => {\r\n        window.location.replace('/mon-compte/user/delete/' + userId);\r\n      });\r\n    });\r\n\r\n    $(document.getElementById('teamManager')).find('tr').each(function () {\r\n      let $this = $(this);\r\n      let userId = $this.attr('rel');\r\n\r\n      // Manage select changes.\r\n      $this.find('select[name=accessLevel]').change(function () {\r\n          let roles = $(this).val();\r\n          window.location.replace('/mon-compte/access/change/' + userId + '/' + roles);\r\n      });\r\n    });\r\n  }\r\n}\r\n","class LgvAdminPageProfile extends LgvAdminPage {\r\n  init() {\r\n    super.init();\r\n\r\n    // Click on edit profile button.\r\n    let $toggle = $('.profileEditToSwitch');\r\n    $('.profileEditSwitch').click(() => {\r\n      $toggle.toggle();\r\n    });\r\n\r\n    // Display form if asked.\r\n    if (this.getParameterByName('edit')) {\r\n      $toggle.toggle();\r\n    }\r\n\r\n    // Change image field.\r\n    let $form = $('#profilePictureForm');\r\n    $form.find('input[type=\"file\"]').change(()=> {\r\n      // Display a nice spinner.\r\n      lgvAdmin.pageLoadingStart();\r\n      // Send form will reload the page.\r\n      $form.submit();\r\n    });\r\n  }\r\n}\r\n","class LgvAdminPageOrga extends LgvAdminPage {\r\n  init() {\r\n    super.init();\r\n\r\n    // On user profile, remove user button.\r\n    $('.orga-delete').click((e) => {\r\n      // Disable default click behavior.\r\n      e.preventDefault();\r\n      var userId = $(e.currentTarget).attr('rel');\r\n      // Use custom modal for message.\r\n      this.admin.modalConfirm('Êtes-vous sûr de vouloir supprimer cette organisation ? Tous les membres associés vont être supprimés.', () => {\r\n        window.location.replace('/mon-compte/orga/delete/' + userId);\r\n      });\r\n    });\r\n\r\n    // Change image field.\r\n    let $form = $('#organisationPictureForm');\r\n    $form.find('input[type=\"file\"]').change(()=> {\r\n        // Display a nice spinner.\r\n        lgvAdmin.pageLoadingStart();\r\n        // Send form will reload the page.\r\n        $form.submit();\r\n    });\r\n  }\r\n}\r\n","// It knows what to do.\nnew LgvAdmin();\n\n"]}