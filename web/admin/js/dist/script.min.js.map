{"version":3,"sources":["web/admin/js/src/class/lgvAdmin.js","web/admin/js/src/class/lgvAdminPage.js","web/admin/js/src/class/lgvAdminPageTeam.js","web/admin/js/src/class/lgvAdminPageProfile.js","web/admin/js/src/class/lgvAdminPageOrga.js","web/admin/js/src/class/field.dbPedia.js","web/admin/js/src/main.js"],"names":["window","log","m","console","LgvAdmin","_this","this","_classCallCheck","$","init","$loadingPageSpin","lgvAdmin","$modalConfirm","$modalConfirmBody","find","$modalConfirmValidate","each","e","item","VirtualAssemblyFieldDbPedia","select2","ajax","url","dataType","delay","data","params","QueryString","term","QueryClass","attr","processResults","items","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","results","Symbol","iterator","next","done","result","value","push","id","uri","text","label","err","return","LgvAdminPageTeam","LgvAdminPageProfile","LgvAdminPageOrga","message","callback","_this2","html","modal","one","removeClass","addClass","LgvAdminPage","admin","cloneWidget","on","parent","first","name","location","href","replace","regex","RegExp","exec","decodeURIComponent","_get","prototype","__proto__","Object","getPrototypeOf","call","click","preventDefault","userId","currentTarget","modalConfirm","document","getElementById","$this","change","roles","val","$toggle","toggle","getParameterByName","$form","pageLoadingStart","submit","dom","$selector","$value","$tags","width","placeholder","MaxHits","selectValues","cache","setValue","startupValue","JSON","parse","getLabelCallback","Array","isArray","key","getDbPediaLabel","fillValues","stringify","empty","$item","append","keys","length","trigger","complete","lang","arguments","propertyUri","headers","Accept","Accept-Language","r","responseJSON"],"mappings":"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","file":"script.min.js","sourcesContent":["window.log = (m) => {\r\n  \"use strict\";\r\n  console.log(m);\r\n};\r\n\r\nclass LgvAdmin {\r\n  constructor() {\r\n    // Wait document loaded.\r\n    $(()=> {\r\n      this.init();\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.$loadingPageSpin = $('#loadingPageSpin');\r\n    // Save globally.\r\n    window.lgvAdmin = this;\r\n\r\n    // Define reused variables.\r\n    this.$modalConfirm = $('#modalConfirm');\r\n    this.$modalConfirmBody = this.$modalConfirm.find('.modal-body:first');\r\n    this.$modalConfirmValidate = this.$modalConfirm.find('.btn-primary:first');\r\n\r\n    $('.select2-dbPedia').each((e, item) => {\r\n      new VirtualAssemblyFieldDbPedia(item);\r\n    });\r\n\r\n    $('.select2-lookup').select2({\r\n      ajax: {\r\n        url: \"/webservice/lookup\",\r\n        dataType: 'json',\r\n        delay: 250,\r\n        data: function (params) {\r\n          return {\r\n            QueryString: params.term,\r\n            QueryClass: $(this).attr('data-query-class')\r\n          };\r\n        },\r\n        processResults: function (data, params) {\r\n          let items = [];\r\n          for (let result of data.results) {\r\n            items.push({\r\n              id: result.uri,\r\n              text: result.label\r\n            });\r\n          }\r\n          return {\r\n            results: items\r\n          };\r\n        }\r\n      }\r\n    });\r\n\r\n    new LgvAdminPageTeam(this);\r\n    new LgvAdminPageProfile(this);\r\n    new LgvAdminPageOrga(this);\r\n  }\r\n\r\n  modalConfirm(message, callback) {\r\n    this.$modalConfirmBody.html(message);\r\n    this.$modalConfirm.modal('show');\r\n    this.$modalConfirmValidate.one('click', () => {\r\n      this.$modalConfirm.modal('hide');\r\n      callback();\r\n    });\r\n  }\r\n\r\n  pageLoadingStart() {\r\n    this.$loadingPageSpin\r\n      .removeClass('fadeOut')\r\n      .addClass('fadeIn');\r\n  }\r\n\r\n  pageLoadingStop() {\r\n    this.$loadingPageSpin\r\n      .removeClass('fadeIn')\r\n      .addClass('fadeOut');\r\n  }\r\n}\r\n","class LgvAdminPage {\r\n  constructor(admin) {\r\n    this.admin = admin;\r\n\r\n    // Need wikipedia.js and formInteraction.js\r\n    if (window.cloneWidget) {\r\n      // Manage widgets duplication.\r\n      $(\".form-group\").on('click', '.add-widget', function () {\r\n        cloneWidget($(this)\r\n          .parent()\r\n          .parent()\r\n          .find('.sf-value-block')\r\n          .first()\r\n          .find('.ref')\r\n          .first())\r\n      });\r\n    }\r\n    this.init();\r\n  }\r\n\r\n  init() {}\r\n\r\n  getParameterByName(name, url) {\r\n    if (!url) {\r\n      url = window.location.href;\r\n    }\r\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\r\n      results = regex.exec(url);\r\n    if (!results) return null;\r\n    if (!results[2]) return '';\r\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\r\n  }\r\n}\r\n","class LgvAdminPageTeam extends LgvAdminPage {\r\n  init() {\r\n    super.init();\r\n\r\n    // On user profile, remove user button.\r\n    $('.team-user-delete').click((e) => {\r\n      // Disable default click behavior.\r\n      e.preventDefault();\r\n      let userId = $(e.currentTarget).attr('rel');\r\n      // Use custom modal for message.\r\n      this.admin.modalConfirm('Êtes-vous sûr de vouloir supprimer ce compte ? ' +\r\n        'Toutes les informations du profil seront perdues, ' +\r\n        'et le membre n\\'aura plus accès au site.', () => {\r\n        window.location.replace('/mon-compte/user/delete/' + userId);\r\n      });\r\n    });\r\n\r\n    $(document.getElementById('teamManager')).find('tr').each(function () {\r\n      let $this = $(this);\r\n      let userId = $this.attr('rel');\r\n\r\n      // Manage select changes.\r\n      $this.find('select[name=accessLevel]').change(function () {\r\n          let roles = $(this).val();\r\n          window.location.replace('/mon-compte/access/change/' + userId + '/' + roles);\r\n      });\r\n    });\r\n  }\r\n}\r\n","class LgvAdminPageProfile extends LgvAdminPage {\r\n  init() {\r\n    super.init();\r\n\r\n    // Click on edit profile button.\r\n    let $toggle = $('.profileEditToSwitch');\r\n    $('.profileEditSwitch').click(() => {\r\n      $toggle.toggle();\r\n    });\r\n\r\n    // Display form if asked.\r\n    if (this.getParameterByName('edit')) {\r\n      $toggle.toggle();\r\n    }\r\n\r\n    // Change image field.\r\n    let $form = $('form[name=profile]');\r\n    $form.find('input[type=\"file\"]').change(()=> {\r\n      // Display a nice spinner.\r\n      lgvAdmin.pageLoadingStart();\r\n      // Send form will reload the page.\r\n      $form.submit();\r\n    });\r\n  }\r\n}\r\n","class LgvAdminPageOrga extends LgvAdminPage {\r\n  init() {\r\n    super.init();\r\n\r\n    // On user profile, remove user button.\r\n    $('.orga-delete').click((e) => {\r\n      // Disable default click behavior.\r\n      e.preventDefault();\r\n      var userId = $(e.currentTarget).attr('rel');\r\n      // Use custom modal for message.\r\n      this.admin.modalConfirm('Êtes-vous sûr de vouloir supprimer cette organisation ? Tous les membres associés vont être supprimés.', () => {\r\n        window.location.replace('/mon-compte/orga/delete/' + userId);\r\n      });\r\n    });\r\n\r\n    // Change image field.\r\n    let $form = $('#organisationPictureForm');\r\n    $form.find('input[type=\"file\"]').change(()=> {\r\n        // Display a nice spinner.\r\n        lgvAdmin.pageLoadingStart();\r\n        // Send form will reload the page.\r\n        $form.submit();\r\n    });\r\n  }\r\n}\r\n","class VirtualAssemblyFieldDbPedia {\n  constructor(dom) {\n    this.value = {};\n    this.$ = $(dom);\n    this.$selector = this.$.find('.tags-selector');\n    this.$value = this.$.find('.tags-value');\n    this.$tags = this.$.find('.tags');\n    this.$selector.select2({\n      width: '100%',\n      placeholder: \"Ajoutez un terme ici\",\n      ajax: {\n        url: \"http://lookup.dbpedia.org/api/search.asmx/PrefixSearch\",\n        dataType: 'json',\n        delay: 250,\n        data: (params) => {\n          return {\n            QueryString: params.term,\n            MaxHits: 15\n          };\n        },\n        processResults: (data) => {\n          let items = [];\n          this.selectValues = {};\n          log(data);\n          for (let result of data.results) {\n            items.push({\n              id: result.uri,\n              text: result.label\n            });\n            this.selectValues[result.uri] = result.label;\n          }\n          return {\n            results: items\n          };\n        },\n        cache: true\n      }\n    });\n    this.$selector.on(\"select2:select\", (e) => {\n      this.setValue(this.$selector.val(), this.selectValues[this.$selector.val()]);\n    });\n\n    // Get value.\n    let startupValue = this.$value.val();\n    // Parse it.\n    startupValue = startupValue && JSON.parse(startupValue);\n    let getLabelCallback = (label, uri) => {\n      this.setValue(uri, label)\n    };\n    // Load it.\n    if (Array.isArray(startupValue)) {\n      $.each(startupValue, (key, uri) => {\n        this.getDbPediaLabel(uri, getLabelCallback);\n      });\n    }\n  }\n\n  setValue(uri, text) {\n    // Add to values.\n    this.value[uri] = text;\n    $.ajax({});\n    // Reload list.\n    this.fillValues();\n  }\n\n  fillValues() {\n    this.$value.val(JSON.stringify(this.value));\n    this.$tags.empty();\n    $.each(this.value, (uri, text) => {\n      // Build item.\n      let $item = $('<span class=\"tag\">' + text + ' <a href=\"#\" class=\"remove-tag glyphicon glyphicon-remove\"></a></span>')\n      // Click event.\n      $item.find('a.remove-tag').click((e) => {\n        e.preventDefault();\n        delete this.value[uri];\n        this.fillValues();\n      });\n      // Append.\n      this.$tags.append($item);\n    });\n    this.$tags.append('<div class=\"clearfix\"></div>');\n    // Show tags section if not empty.\n    this.$tags.toggle(!!Object.keys(this.value).length);\n    // Clear selector.\n    this.$selector.val(null).trigger(\"change\");\n  }\n\n  getDbPediaLabel(uri, complete, lang = 'fr', propertyUri = 'http://www.w3.org/2000/01/rdf-schema#label') {\n    $.ajax({\n      headers: {\n        // Ensure to get JSON response.\n        'Accept': 'application/json',\n        'Accept-Language': 'fr'\n      },\n      url: uri,\n      complete: (r) => {\n        \"use strict\";\n        $.each(r.responseJSON[uri][propertyUri], (key, data) => {\n          if (data.lang === lang) {\n            complete(data.value, uri);\n          }\n        })\n      }\n    });\n  }\n}\n\n\n","// It knows what to do.\nnew LgvAdmin();\n\n"]}